(self.webpackChunk=self.webpackChunk||[]).push([[600],{6497:function(e){e.exports=/<%=([\s\S]+?)%>/g},6169:function(e,t,n){e=n.nmd(e);var r=n(6497),i=n(7796),o=1/0,s=9007199254740991,a="[object Arguments]",c="[object AsyncFunction]",l="[object DOMException]",u="[object Error]",h="[object Function]",p="[object GeneratorFunction]",d="[object Null]",f="[object Object]",g="[object Proxy]",m="[object Symbol]",y="[object Undefined]",v=/\b__p \+= '';/g,b=/\b(__p \+=) '' \+/g,w=/(__e\(.*?\)|\b__t\)) \+\n'';/g,k=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,x=/^\[object .+?Constructor\]$/,S=/^(?:0|[1-9]\d*)$/,O=/($^)/,M=/['\n\r\u2028\u2029\\]/g,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[a]=P["[object Array]"]=P["[object ArrayBuffer]"]=P["[object Boolean]"]=P["[object DataView]"]=P["[object Date]"]=P[u]=P[h]=P["[object Map]"]=P["[object Number]"]=P[f]=P["[object RegExp]"]=P["[object Set]"]=P["[object String]"]=P["[object WeakMap]"]=!1;var _={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},A="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,j="object"==typeof self&&self&&self.Object===Object&&self,E=A||j||Function("return this")(),L=t&&!t.nodeType&&t,I=L&&e&&!e.nodeType&&e,C=I&&I.exports===L,D=C&&A.process,T=function(){try{var e=I&&I.require&&I.require("util").types;return e||D&&D.binding&&D.binding("util")}catch(e){}}(),R=T&&T.isTypedArray;function Z(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function B(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}function F(e){return"\\"+_[e]}function N(e,t){return function(n){return e(t(n))}}var U,V=Function.prototype,$=Object.prototype,z=E["__core-js_shared__"],q=V.toString,G=$.hasOwnProperty,X=(U=/[^.]+$/.exec(z&&z.keys&&z.keys.IE_PROTO||""))?"Symbol(src)_1."+U:"",H=$.toString,J=q.call(Object),K=RegExp("^"+q.call(G).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Y=C?E.Buffer:void 0,W=E.Symbol,Q=N(Object.getPrototypeOf,Object),ee=$.propertyIsEnumerable,te=W?W.toStringTag:void 0,ne=function(){try{var e=function(e){if(!De(e)||function(e){return!!X&&X in e}(e))return!1;var t=Ie(e)?K:x;return t.test(function(e){if(null!=e){try{return q.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e))}(t=function(e,t){return null==e?void 0:e[t]}(Object,"defineProperty"))?t:void 0;return e({},"",{}),e}catch(e){}var t}(),re=Y?Y.isBuffer:void 0,ie=N(Object.keys,Object),oe=Math.max,se=Date.now,ae=W?W.prototype:void 0,ce=ae?ae.toString:void 0;function le(e,t){var n=Ae(e),r=!n&&_e(e),i=!n&&!r&&Ee(e),o=!n&&!r&&!i&&Re(e),s=n||r||i||o,a=s?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=a.length;for(var l in e)!t&&!G.call(e,l)||s&&("length"==l||i&&("offset"==l||"parent"==l)||o&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||be(l,c))||a.push(l);return a}function ue(e,t,n){var r=e[t];G.call(e,t)&&Pe(r,n)&&(void 0!==n||t in e)||he(e,t,n)}function he(e,t,n){"__proto__"==t&&ne?ne(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function pe(e){return null==e?void 0===e?y:d:te&&te in Object(e)?function(e){var t=G.call(e,te),n=e[te];try{e[te]=void 0;var r=!0}catch(e){}var i=H.call(e);r&&(t?e[te]=n:delete e[te]);return i}(e):function(e){return H.call(e)}(e)}function de(e){return Te(e)&&pe(e)==a}function fe(e){if(!De(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=ke(e),n=[];for(var r in e)("constructor"!=r||!t&&G.call(e,r))&&n.push(r);return n}function ge(e,t){return Me(function(e,t,n){return t=oe(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=oe(r.length-t,0),s=Array(o);++i<o;)s[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(s),Z(e,this,a)}}(e,t,Ue),e+"")}var me=ne?function(e,t){return ne(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:Ue;function ye(e){if("string"==typeof e)return e;if(Ae(e))return B(e,ye)+"";if(function(e){return"symbol"==typeof e||Te(e)&&pe(e)==m}(e))return ce?ce.call(e):"";var t=e+"";return"0"==t&&1/e==-o?"-0":t}function ve(e,t,n,r){return void 0===e||Pe(e,$[n])&&!G.call(r,n)?t:e}function be(e,t){var n=typeof e;return!!(t=null==t?s:t)&&("number"==n||"symbol"!=n&&S.test(e))&&e>-1&&e%1==0&&e<t}function we(e,t,n){if(!De(n))return!1;var r=typeof t;return!!("number"==r?je(n)&&be(t,n.length):"string"==r&&t in n)&&Pe(n[t],e)}function ke(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||$)}var xe,Se,Oe,Me=(xe=me,Se=0,Oe=0,function(){var e=se(),t=16-(e-Oe);if(Oe=e,t>0){if(++Se>=800)return arguments[0]}else Se=0;return xe.apply(void 0,arguments)});function Pe(e,t){return e===t||e!=e&&t!=t}var _e=de(function(){return arguments}())?de:function(e){return Te(e)&&G.call(e,"callee")&&!ee.call(e,"callee")},Ae=Array.isArray;function je(e){return null!=e&&Ce(e.length)&&!Ie(e)}var Ee=re||function(){return!1};function Le(e){if(!Te(e))return!1;var t=pe(e);return t==u||t==l||"string"==typeof e.message&&"string"==typeof e.name&&!function(e){if(!Te(e)||pe(e)!=f)return!1;var t=Q(e);if(null===t)return!0;var n=G.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&q.call(n)==J}(e)}function Ie(e){if(!De(e))return!1;var t=pe(e);return t==h||t==p||t==c||t==g}function Ce(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=s}function De(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Te(e){return null!=e&&"object"==typeof e}var Re=R?function(e){return function(t){return e(t)}}(R):function(e){return Te(e)&&Ce(e.length)&&!!P[pe(e)]};var Ze,Be=(Ze=function(e,t,n,r){!function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?he(n,a,c):ue(n,a,c)}}(t,function(e){return je(e)?le(e,!0):fe(e)}(t),e,r)},ge((function(e,t){var n=-1,r=t.length,i=r>1?t[r-1]:void 0,o=r>2?t[2]:void 0;for(i=Ze.length>3&&"function"==typeof i?(r--,i):void 0,o&&we(t[0],t[1],o)&&(i=r<3?void 0:i,r=1),e=Object(e);++n<r;){var s=t[n];s&&Ze(e,s,n,i)}return e})));function Fe(e){return je(e)?le(e):function(e){if(!ke(e))return ie(e);var t=[];for(var n in Object(e))G.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)}var Ne=ge((function(e,t){try{return Z(e,void 0,t)}catch(e){return Le(e)?e:new Error(e)}}));function Ue(e){return e}e.exports=function(e,t,n){var o,s=i.imports._.templateSettings||i;n&&we(e,t,n)&&(t=void 0),e=null==(o=e)?"":ye(o),t=Be({},t,s,ve);var a,c,l,u=Be({},t.imports,s.imports,ve),h=Fe(u),p=(a=u,B(h,(function(e){return a[e]}))),d=0,f=t.interpolate||O,g="__p += '",m=RegExp((t.escape||O).source+"|"+f.source+"|"+(f===r?k:O).source+"|"+(t.evaluate||O).source+"|$","g"),y=G.call(t,"sourceURL")?"//# sourceURL="+(t.sourceURL+"").replace(/[\r\n]/g," ")+"\n":"";e.replace(m,(function(t,n,r,i,o,s){return r||(r=i),g+=e.slice(d,s).replace(M,F),n&&(c=!0,g+="' +\n__e("+n+") +\n'"),o&&(l=!0,g+="';\n"+o+";\n__p += '"),r&&(g+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),d=s+t.length,t})),g+="';\n";var x=G.call(t,"variable")&&t.variable;x||(g="with (obj) {\n"+g+"\n}\n"),g=(l?g.replace(v,""):g).replace(b,"$1").replace(w,"$1;"),g="function("+(x||"obj")+") {\n"+(x?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(c?", __e = _.escape":"")+(l?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+g+"return __p\n}";var S=Ne((function(){return Function(h,y+"return "+g).apply(void 0,p)}));if(S.source=g,Le(S))throw S;return S}},7796:function(e,t,n){var r=n(6497),i=1/0,o="[object Null]",s="[object Symbol]",a="[object Undefined]",c=/[&<>"']/g,l=RegExp(c.source),u="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,h="object"==typeof self&&self&&self.Object===Object&&self,p=u||h||Function("return this")();var d,f=(d={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},function(e){return null==d?void 0:d[e]}),g=Object.prototype,m=g.hasOwnProperty,y=g.toString,v=p.Symbol,b=v?v.toStringTag:void 0,w=v?v.prototype:void 0,k=w?w.toString:void 0,x={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:r,variable:"",imports:{_:{escape:function(e){return(e=P(e))&&l.test(e)?e.replace(c,f):e}}}};function S(e){return null==e?void 0===e?a:o:b&&b in Object(e)?function(e){var t=m.call(e,b),n=e[b];try{e[b]=void 0;var r=!0}catch(e){}var i=y.call(e);r&&(t?e[b]=n:delete e[b]);return i}(e):function(e){return y.call(e)}(e)}function O(e){if("string"==typeof e)return e;if(M(e))return function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}(e,O)+"";if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&S(e)==s}(e))return k?k.call(e):"";var t=e+"";return"0"==t&&1/e==-i?"-0":t}var M=Array.isArray;function P(e){return null==e?"":O(e)}e.exports=x},3904:function(e,t,n){"use strict";function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e){var t=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==r(t)?t:String(t)}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,o(r.key),r)}}function a(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function h(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}function p(e){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},p(e)}function d(e,t,n){return(t=o(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var v={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},b=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e),this.init(t,n)}return a(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||v,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,r){return r&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,y(y({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}}]),e}(),w=new b,k=function(){function e(){i(this,e),this.observers={}}return a(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,n)}));this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(n))}))}}]),e}();function x(){var e,t,n=new Promise((function(n,r){e=n,t=r}));return n.resolve=e,n.reject=t,n}function S(e){return null==e?"":""+e}function O(e,t,n){function r(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function i(){return!e||"string"==typeof e}for(var o="string"!=typeof t?[].concat(t):t.split(".");o.length>1;){if(i())return{};var s=r(o.shift());!e[s]&&n&&(e[s]=new n),e=Object.prototype.hasOwnProperty.call(e,s)?e[s]:{}}return i()?{}:{obj:e,k:r(o.shift())}}function M(e,t,n){var r=O(e,t,Object);r.obj[r.k]=n}function P(e,t){var n=O(e,t),r=n.obj,i=n.k;if(r)return r[i]}function _(e,t,n){var r=P(e,n);return void 0!==r?r:P(t,n)}function A(e,t,n){for(var r in t)"__proto__"!==r&&"constructor"!==r&&(r in e?"string"==typeof e[r]||e[r]instanceof String||"string"==typeof t[r]||t[r]instanceof String?n&&(e[r]=t[r]):A(e[r],t[r],n):e[r]=t[r]);return e}function j(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var E={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function L(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return E[e]})):e}var I="undefined"!=typeof window&&window.navigator&&void 0===window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,C=[" ",",","?","!",";"];function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h(this,n)}}function Z(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var r=t.split(n),i=e,o=0;o<r.length;++o){if(!i)return;if("string"==typeof i[r[o]]&&o+1<r.length)return;if(void 0===i[r[o]]){for(var s=2,a=r.slice(o,o+s).join(n),c=i[a];void 0===c&&r.length>o+s;)s++,c=i[a=r.slice(o,o+s).join(n)];if(void 0===c)return;if(t.endsWith(a)){if("string"==typeof c)return c;if(a&&"string"==typeof c[a])return c[a]}var l=r.slice(o+s).join(n);return l?Z(c,l,n):void 0}i=i[r[o]]}return i}}var B=function(e){u(n,e);var t=R(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return i(this,n),r=t.call(this),I&&k.call(c(r)),r.data=e||{},r.options=o,void 0===r.options.keySeparator&&(r.options.keySeparator="."),void 0===r.options.ignoreJSONStructure&&(r.options.ignoreJSONStructure=!0),r}return a(n,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=void 0!==r.keySeparator?r.keySeparator:this.options.keySeparator,o=void 0!==r.ignoreJSONStructure?r.ignoreJSONStructure:this.options.ignoreJSONStructure,s=[e,t];n&&"string"!=typeof n&&(s=s.concat(n)),n&&"string"==typeof n&&(s=s.concat(i?n.split(i):n)),e.indexOf(".")>-1&&(s=e.split("."));var a=P(this.data,s);return a||!o||"string"!=typeof n?a:Z(this.data&&this.data[e]&&this.data[e][t],n,i)}},{key:"addResource",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},o=this.options.keySeparator;void 0===o&&(o=".");var s=[e,t];n&&(s=s.concat(o?n.split(o):n)),e.indexOf(".")>-1&&(r=t,t=(s=e.split("."))[1]),this.addNamespaces(t),M(this.data,s,r),i.silent||this.emit("added",e,t,n,r)}},{key:"addResources",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var i in n)"string"!=typeof n[i]&&"[object Array]"!==Object.prototype.toString.apply(n[i])||this.addResource(e,t,i,n[i],{silent:!0});r.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},s=[e,t];e.indexOf(".")>-1&&(r=n,n=t,t=(s=e.split("."))[1]),this.addNamespaces(t);var a=P(this.data,s)||{};r?A(a,n,i):a=T(T({},a),n),M(this.data,s,a),o.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?T(T({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((function(e){return t[e]&&Object.keys(t[e]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),n}(k),F={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,r,i){var o=this;return e.forEach((function(e){o.processors[e]&&(t=o.processors[e].process(t,n,r,i))})),t}};function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function V(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h(this,n)}}var $={},z=function(e){u(n,e);var t=V(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i(this,n),r=t.call(this),I&&k.call(c(r)),function(e,t,n){e.forEach((function(e){t[e]&&(n[e]=t[e])}))}(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,c(r)),r.options=o,void 0===r.options.keySeparator&&(r.options.keySeparator="."),r.logger=w.create("translator"),r}return a(n,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var r=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,i=t.ns||this.options.defaultNS||[],o=n&&e.indexOf(n)>-1,s=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||function(e,t,n){t=t||"",n=n||"";var r=C.filter((function(e){return t.indexOf(e)<0&&n.indexOf(e)<0}));if(0===r.length)return!0;var i=new RegExp("(".concat(r.map((function(e){return"?"===e?"\\?":e})).join("|"),")")),o=!i.test(e);if(!o){var s=e.indexOf(n);s>0&&!i.test(e.substring(0,s))&&(o=!0)}return o}(e,n,r));if(o&&!s){var a=e.match(this.interpolator.nestingRegexp);if(a&&a.length>0)return{key:e,namespaces:i};var c=e.split(n);(n!==r||n===r&&this.options.ns.indexOf(c[0])>-1)&&(i=c.shift()),e=c.join(r)}return"string"==typeof i&&(i=[i]),{key:e,namespaces:i}}},{key:"translate",value:function(e,t,i){var o=this;if("object"!==r(t)&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var s=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,a=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,c=this.extractFromKey(e[e.length-1],t),l=c.key,u=c.namespaces,h=u[u.length-1],p=t.lng||this.language,d=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(p&&"cimode"===p.toLowerCase()){if(d){var f=t.nsSeparator||this.options.nsSeparator;return s?(g.res="".concat(h).concat(f).concat(l),g):"".concat(h).concat(f).concat(l)}return s?(g.res=l,g):l}var g=this.resolve(e,t),m=g&&g.res,y=g&&g.usedKey||l,v=g&&g.exactUsedKey||l,b=Object.prototype.toString.apply(m),w=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,k=!this.i18nFormat||this.i18nFormat.handleAsObject;if(k&&m&&("string"!=typeof m&&"boolean"!=typeof m&&"number"!=typeof m)&&["[object Number]","[object Function]","[object RegExp]"].indexOf(b)<0&&("string"!=typeof w||"[object Array]"!==b)){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var x=this.options.returnedObjectHandler?this.options.returnedObjectHandler(y,m,U(U({},t),{},{ns:u})):"key '".concat(l," (").concat(this.language,")' returned an object instead of string.");return s?(g.res=x,g):x}if(a){var S="[object Array]"===b,O=S?[]:{},M=S?v:y;for(var P in m)if(Object.prototype.hasOwnProperty.call(m,P)){var _="".concat(M).concat(a).concat(P);O[P]=this.translate(_,U(U({},t),{joinArrays:!1,ns:u})),O[P]===_&&(O[P]=m[P])}m=O}}else if(k&&"string"==typeof w&&"[object Array]"===b)(m=m.join(w))&&(m=this.extendTranslation(m,e,t,i));else{var A=!1,j=!1,E=void 0!==t.count&&"string"!=typeof t.count,L=n.hasDefaultValue(t),I=E?this.pluralResolver.getSuffix(p,t.count,t):"",C=t["defaultValue".concat(I)]||t.defaultValue;!this.isValidLookup(m)&&L&&(A=!0,m=C),this.isValidLookup(m)||(j=!0,m=l);var D=(t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&j?void 0:m,T=L&&C!==m&&this.options.updateMissing;if(j||A||T){if(this.logger.log(T?"updateKey":"missingKey",p,h,l,T?C:m),a){var R=this.resolve(l,U(U({},t),{},{keySeparator:!1}));R&&R.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var Z=[],B=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&B&&B[0])for(var F=0;F<B.length;F++)Z.push(B[F]);else"all"===this.options.saveMissingTo?Z=this.languageUtils.toResolveHierarchy(t.lng||this.language):Z.push(t.lng||this.language);var N=function(e,n,r){var i=L&&r!==m?r:D;o.options.missingKeyHandler?o.options.missingKeyHandler(e,h,n,i,T,t):o.backendConnector&&o.backendConnector.saveMissing&&o.backendConnector.saveMissing(e,h,n,i,T,t),o.emit("missingKey",e,h,n,m)};this.options.saveMissing&&(this.options.saveMissingPlurals&&E?Z.forEach((function(e){o.pluralResolver.getSuffixes(e,t).forEach((function(n){N([e],l+n,t["defaultValue".concat(n)]||C)}))})):N(Z,l,C))}m=this.extendTranslation(m,e,t,g,i),j&&m===l&&this.options.appendNamespaceToMissingKey&&(m="".concat(h,":").concat(l)),(j||A)&&this.options.parseMissingKeyHandler&&(m="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(l,A?m:void 0):this.options.parseMissingKeyHandler(m))}return s?(g.res=m,g):m}},{key:"extendTranslation",value:function(e,t,n,r,i){var o=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,U(U({},this.options.interpolation.defaultVariables),n),r.usedLng,r.usedNS,r.usedKey,{resolved:r});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(U(U({},n),{interpolation:U(U({},this.options.interpolation),n.interpolation)}));var s,a="string"==typeof e&&(n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(a){var c=e.match(this.interpolator.nestingRegexp);s=c&&c.length}var l=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(l=U(U({},this.options.interpolation.defaultVariables),l)),e=this.interpolator.interpolate(e,l,n.lng||this.language,n),a){var u=e.match(this.interpolator.nestingRegexp);s<(u&&u.length)&&(n.nest=!1)}!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];return i&&i[0]===r[0]&&!n.context?(o.logger.warn("It seems you are nesting recursively key: ".concat(r[0]," in key: ").concat(t[0])),null):o.translate.apply(o,r.concat([t]))}),n)),n.interpolation&&this.interpolator.reset()}var h=n.postProcess||this.options.postProcess,p="string"==typeof h?[h]:h;return null!=e&&p&&p.length&&!1!==n.applyPostProcessor&&(e=F.handle(p,e,t,this.options&&this.options.postProcessPassResolved?U({i18nResolved:r},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,r,i,o,s=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!s.isValidLookup(t)){var c=s.extractFromKey(e,a),l=c.key;n=l;var u=c.namespaces;s.options.fallbackNS&&(u=u.concat(s.options.fallbackNS));var h=void 0!==a.count&&"string"!=typeof a.count,p=h&&!a.ordinal&&0===a.count&&s.pluralResolver.shouldUseIntlApi(),d=void 0!==a.context&&("string"==typeof a.context||"number"==typeof a.context)&&""!==a.context,f=a.lngs?a.lngs:s.languageUtils.toResolveHierarchy(a.lng||s.language,a.fallbackLng);u.forEach((function(e){s.isValidLookup(t)||(o=e,!$["".concat(f[0],"-").concat(e)]&&s.utils&&s.utils.hasLoadedNamespace&&!s.utils.hasLoadedNamespace(o)&&($["".concat(f[0],"-").concat(e)]=!0,s.logger.warn('key "'.concat(n,'" for languages "').concat(f.join(", "),'" won\'t get resolved as namespace "').concat(o,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach((function(n){if(!s.isValidLookup(t)){i=n;var o,c=[l];if(s.i18nFormat&&s.i18nFormat.addLookupKeys)s.i18nFormat.addLookupKeys(c,l,n,e,a);else{var u;h&&(u=s.pluralResolver.getSuffix(n,a.count,a));var f="_zero";if(h&&(c.push(l+u),p&&c.push(l+f)),d){var g="".concat(l).concat(s.options.contextSeparator).concat(a.context);c.push(g),h&&(c.push(g+u),p&&c.push(g+f))}}for(;o=c.pop();)s.isValidLookup(t)||(r=o,t=s.getResource(n,e,o,a))}})))}))}})),{res:t,usedKey:n,exactUsedKey:r,usedLng:i,usedNS:o}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,r):this.resourceStore.getResource(e,t,n,r)}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&t===n.substring(0,12)&&void 0!==e[n])return!0;return!1}}]),n}(k);function q(e){return e.charAt(0).toUpperCase()+e.slice(1)}var G=function(){function e(t){i(this,e),this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=w.create("languageUtils")}return a(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=q(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=q(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=q(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach((function(e){if(!t){var r=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(r)||(t=r)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var r=n.getLanguagePartFromCode(e);if(n.isSupportedCode(r))return t=r;t=n.options.supportedLngs.find((function(e){if(0===e.indexOf(r))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,r=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],o=function(e){e&&(n.isSupportedCode(e)?i.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&o(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&o(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&o(this.getLanguagePartFromCode(e))):"string"==typeof e&&o(this.formatLanguageCode(e)),r.forEach((function(e){i.indexOf(e)<0&&o(n.formatLanguageCode(e))})),i}}]),e}(),X=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],H={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},J=["v1","v2","v3"],K={zero:0,one:1,two:2,few:3,many:4,other:5};var Y=function(){function e(t){var n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e),this.languageUtils=t,this.options=r,this.logger=w.create("pluralResolver"),this.options.compatibilityJSON&&"v4"!==this.options.compatibilityJSON||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(n={},X.forEach((function(e){e.lngs.forEach((function(t){n[t]={numbers:e.nr,plurals:H[e.fc]}}))})),n)}return a(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(e,{type:t.ordinal?"ordinal":"cardinal"})}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map((function(e){return"".concat(t).concat(e)}))}},{key:"getSuffixes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getRule(e,n);return r?this.shouldUseIntlApi()?r.resolvedOptions().pluralCategories.sort((function(e,t){return K[e]-K[t]})).map((function(e){return"".concat(t.options.prepend).concat(e)})):r.numbers.map((function(r){return t.getSuffix(e,r,n)})):[]}},{key:"getSuffix",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.getRule(e,n);return r?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(r.select(t)):this.getSuffixRetroCompatible(r,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var n=this,r=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),i=e.numbers[r];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===i?i="plural":1===i&&(i=""));var o=function(){return n.options.prepend&&i.toString()?n.options.prepend+i.toString():i.toString()};return"v1"===this.options.compatibilityJSON?1===i?"":"number"==typeof i?"_plural_".concat(i.toString()):o():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?o():this.options.prepend&&r.toString()?this.options.prepend+r.toString():r.toString()}},{key:"shouldUseIntlApi",value:function(){return!J.includes(this.options.compatibilityJSON)}}]),e}();function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ee=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.logger=w.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return a(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:L,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?j(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?j(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?j(t.nestingPrefix):t.nestingPrefixEscaped||j("$t("),this.nestingSuffix=t.nestingSuffix?j(t.nestingSuffix):t.nestingSuffixEscaped||j(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,r){var i,o,s,a=this,c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function l(e){return e.replace(/\$/g,"$$$$")}var u=function(e){if(e.indexOf(a.formatSeparator)<0){var i=_(t,c,e);return a.alwaysFormat?a.format(i,void 0,n,Q(Q(Q({},r),t),{},{interpolationkey:e})):i}var o=e.split(a.formatSeparator),s=o.shift().trim(),l=o.join(a.formatSeparator).trim();return a.format(_(t,c,s),l,n,Q(Q(Q({},r),t),{},{interpolationkey:s}))};this.resetRegExp();var h=r&&r.missingInterpolationHandler||this.options.missingInterpolationHandler,p=r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return l(e)}},{regex:this.regexp,safeValue:function(e){return a.escapeValue?l(a.escape(e)):l(e)}}].forEach((function(t){for(s=0;i=t.regex.exec(e);){var n=i[1].trim();if(void 0===(o=u(n)))if("function"==typeof h){var c=h(e,i,r);o="string"==typeof c?c:""}else if(r&&r.hasOwnProperty(n))o="";else{if(p){o=i[0];continue}a.logger.warn("missed to pass in variable ".concat(n," for interpolating ").concat(e)),o=""}else"string"==typeof o||a.useRawValueToEscape||(o=S(o));var l=t.safeValue(o);if(e=e.replace(i[0],l),p?(t.regex.lastIndex+=l.length,t.regex.lastIndex-=i[0].length):t.regex.lastIndex=0,++s>=a.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var n,r,i=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=Q({},o);function a(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var r=e.split(new RegExp("".concat(n,"[ ]*{"))),i="{".concat(r[1]);e=r[0],i=(i=this.interpolate(i,s)).replace(/'/g,'"');try{s=JSON.parse(i),t&&(s=Q(Q({},t),s))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(n).concat(i)}return delete s.defaultValue,e}for(s.applyPostProcessor=!1,delete s.defaultValue;n=this.nestingRegexp.exec(e);){var c=[],l=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){var u=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=u.shift(),c=u,l=!0}if((r=t(a.call(this,n[1].trim(),s),s))&&n[0]===e&&"string"!=typeof r)return r;"string"!=typeof r&&(r=S(r)),r||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),r=""),l&&(r=c.reduce((function(e,t){return i.format(e,t,o.lng,Q(Q({},o),{},{interpolationkey:n[1].trim()}))}),r.trim())),e=e.replace(n[0],r),this.regexp.lastIndex=0}return e}}]),e}();function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e),this.logger=w.create("formatter"),this.options=t,this.formats={number:function(e,t,n){return new Intl.NumberFormat(t,n).format(e)},currency:function(e,t,n){return new Intl.NumberFormat(t,ne(ne({},n),{},{style:"currency"})).format(e)},datetime:function(e,t,n){return new Intl.DateTimeFormat(t,ne({},n)).format(e)},relativetime:function(e,t,n){return new Intl.RelativeTimeFormat(t,ne({},n)).format(e,n.range||"day")},list:function(e,t,n){return new Intl.ListFormat(t,ne({},n)).format(e)}},this.init(t)}return a(e,[{key:"init",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"format",value:function(e,t,n,r){var i=this;return t.split(this.formatSeparator).reduce((function(e,t){var o=function(e){var t=e.toLowerCase().trim(),n={};if(e.indexOf("(")>-1){var r=e.split("(");t=r[0].toLowerCase().trim();var i=r[1].substring(0,r[1].length-1);"currency"===t&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):"relativetime"===t&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach((function(e){if(e){var t=g(e.split(":")),r=t[0],i=t.slice(1).join(":");n[r.trim()]||(n[r.trim()]=i.trim()),"false"===i.trim()&&(n[r.trim()]=!1),"true"===i.trim()&&(n[r.trim()]=!0),isNaN(i.trim())||(n[r.trim()]=parseInt(i.trim(),10))}}))}return{formatName:t,formatOptions:n}}(t),s=o.formatName,a=o.formatOptions;if(i.formats[s]){var c=e;try{var l=r&&r.formatParams&&r.formatParams[r.interpolationkey]||{},u=l.locale||l.lng||r.locale||r.lng||n;c=i.formats[s](e,u,ne(ne(ne({},a),r),l))}catch(e){i.logger.warn(e)}return c}return i.logger.warn("there was no format function for ".concat(s)),e}),e)}}]),e}();function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function se(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h(this,n)}}var ae=function(e){u(n,e);var t=se(n);function n(e,r,o){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return i(this,n),s=t.call(this),I&&k.call(c(s)),s.backend=e,s.store=r,s.services=o,s.languageUtils=o.languageUtils,s.options=a,s.logger=w.create("backendConnector"),s.waitingReads=[],s.maxParallelReads=a.maxParallelReads||10,s.readingCalls=0,s.state={},s.queue=[],s.backend&&s.backend.init&&s.backend.init(o,a.backend,a),s}return a(n,[{key:"queueLoad",value:function(e,t,n,r){var i=this,o={},s={},a={},c={};return e.forEach((function(e){var r=!0;t.forEach((function(t){var a="".concat(e,"|").concat(t);!n.reload&&i.store.hasResourceBundle(e,t)?i.state[a]=2:i.state[a]<0||(1===i.state[a]?void 0===s[a]&&(s[a]=!0):(i.state[a]=1,r=!1,void 0===s[a]&&(s[a]=!0),void 0===o[a]&&(o[a]=!0),void 0===c[t]&&(c[t]=!0)))})),r||(a[e]=!0)})),(Object.keys(o).length||Object.keys(s).length)&&this.queue.push({pending:s,pendingCount:Object.keys(s).length,loaded:{},errors:[],callback:r}),{toLoad:Object.keys(o),pending:Object.keys(s),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(c)}}},{key:"loaded",value:function(e,t,n){var r=e.split("|"),i=r[0],o=r[1];t&&this.emit("failedLoading",i,o,t),n&&this.store.addResourceBundle(i,o,n),this.state[e]=t?-1:2;var s={};this.queue.forEach((function(n){var r,a,c,l,u,h;r=n.loaded,a=o,l=O(r,[i],Object),u=l.obj,h=l.k,u[h]=u[h]||[],c&&(u[h]=u[h].concat(a)),c||u[h].push(a),function(e,t){delete e.pending[t],e.pendingCount--}(n,e),t&&n.errors.push(t),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach((function(e){s[e]||(s[e]={});var t=Object.keys(s[e]);t.length&&t.forEach((function(n){void 0!==t[n]&&(s[e][n]=!0)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",s),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,n){var r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:350,s=arguments.length>5?arguments[5]:void 0;return e.length?this.readingCalls>=this.maxParallelReads?void this.waitingReads.push({lng:e,ns:t,fcName:n,tried:i,wait:o,callback:s}):(this.readingCalls++,this.backend[n](e,t,(function(a,c){if(a&&c&&i<5)setTimeout((function(){r.read.call(r,e,t,n,i+1,2*o,s)}),o);else{if(r.readingCalls--,r.waitingReads.length>0){var l=r.waitingReads.shift();r.read(l.lng,l.ns,l.fcName,l.tried,l.wait,l.callback)}s(a,c)}}))):s(null,{})}},{key:"prepareLoading",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var o=this.queueLoad(e,t,r,i);if(!o.toLoad.length)return o.pending.length||i(),null;o.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=e.split("|"),i=r[0],o=r[1];this.read(i,o,"read",void 0,void 0,(function(r,s){r&&t.logger.warn("".concat(n,"loading namespace ").concat(o," for language ").concat(i," failed"),r),!r&&s&&t.logger.log("".concat(n,"loaded namespace ").concat(o," for language ").concat(i),s),t.loaded(e,r,s)}))}},{key:"saveMissing",value:function(e,t,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=n&&""!==n&&(this.backend&&this.backend.create&&this.backend.create(e,t,n,r,null,oe(oe({},o),{},{isUpdate:i})),e&&e[0]&&this.store.addResource(e[0],t,n,r))}}]),n}(k);function ce(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){d(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p(e);if(t){var i=p(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h(this,n)}}function pe(){}var de=function(e){u(n,e);var t=he(n);function n(){var e,r,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;if(i(this,n),e=t.call(this),I&&k.call(c(e)),e.options=ce(o),e.services={},e.logger=w,e.modules={external:[]},r=c(e),Object.getOwnPropertyNames(Object.getPrototypeOf(r)).forEach((function(e){"function"==typeof r[e]&&(r[e]=r[e].bind(r))})),s&&!e.isInitialized&&!o.isClone){if(!e.options.initImmediate)return e.init(o,s),h(e,c(e));setTimeout((function(){e.init(o,s)}),0)}return e}return a(n,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;"function"==typeof t&&(n=t,t={}),!t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));var i={debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===r(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===r(e[2])||"object"===r(e[3])){var n=e[3]||e[2];Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,n,r){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}};function o(e){return e?"function"==typeof e?new e:e:null}if(this.options=ue(ue(ue({},i),this.options),ce(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=ue(ue({},i.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){var s;this.modules.logger?w.init(o(this.modules.logger),this.options):w.init(null,this.options),this.modules.formatter?s=this.modules.formatter:"undefined"!=typeof Intl&&(s=re);var a=new G(this.options);this.store=new B(this.options.resources,this.options);var c=this.services;c.logger=w,c.resourceStore=this.store,c.languageUtils=a,c.pluralResolver=new Y(a,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!s||this.options.interpolation.format&&this.options.interpolation.format!==i.interpolation.format||(c.formatter=o(s),c.formatter.init(c,this.options),this.options.interpolation.format=c.formatter.format.bind(c.formatter)),c.interpolator=new ee(this.options),c.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},c.backendConnector=new ae(o(this.modules.backend),c.resourceStore,c,this.options),c.backendConnector.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit.apply(e,[t].concat(r))})),this.modules.languageDetector&&(c.languageDetector=o(this.modules.languageDetector),c.languageDetector.init(c,this.options.detection,this.options)),this.modules.i18nFormat&&(c.i18nFormat=o(this.modules.i18nFormat),c.i18nFormat.init&&c.i18nFormat.init(this)),this.translator=new z(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];e.emit.apply(e,[t].concat(r))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.format=this.options.interpolation.format,n||(n=pe),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}}));["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments),e}}));var u=x(),h=function(){var t=function(t,r){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),u.resolve(r),n(t,r)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?h():setTimeout(h,0),u}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pe,r="string"==typeof e?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(r&&"cimode"===r.toLowerCase())return n();var i=[],o=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){i.indexOf(e)<0&&i.push(e)}))};if(r)o(r);else this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return o(e)}));this.options.preload&&this.options.preload.forEach((function(e){return o(e)})),this.services.backendConnector.load(i,this.options.ns,(function(e){e||t.resolvedLanguage||!t.language||t.setResolvedLanguage(t.language),n(e)}))}else n(null)}},{key:"reloadResources",value:function(e,t,n){var r=x();return e||(e=this.languages),t||(t=this.options.ns),n||(n=pe),this.services.backendConnector.reload(e,t,(function(e){r.resolve(),n(e)})),r}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&F.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var n=this.languages[t];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}},{key:"changeLanguage",value:function(e,t){var n=this;this.isLanguageChangingTo=e;var r=x();this.emit("languageChanging",e);var i=function(e){n.language=e,n.languages=n.services.languageUtils.toResolveHierarchy(e),n.resolvedLanguage=void 0,n.setResolvedLanguage(e)},o=function(o){e||o||!n.services.languageDetector||(o=[]);var s="string"==typeof o?o:n.services.languageUtils.getBestMatchFromCodes(o);s&&(n.language||i(s),n.translator.language||n.translator.changeLanguage(s),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage(s)),n.loadResources(s,(function(e){!function(e,o){o?(i(o),n.translator.changeLanguage(o),n.isLanguageChangingTo=void 0,n.emit("languageChanged",o),n.logger.log("languageChanged",o)):n.isLanguageChangingTo=void 0,r.resolve((function(){return n.t.apply(n,arguments)})),t&&t(e,(function(){return n.t.apply(n,arguments)}))}(e,s)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(o):o(e):o(this.services.languageDetector.detect()),r}},{key:"getFixedT",value:function(e,t,n){var i=this,o=function e(t,o){var s;if("object"!==r(o)){for(var a=arguments.length,c=new Array(a>2?a-2:0),l=2;l<a;l++)c[l-2]=arguments[l];s=i.options.overloadTranslationOptionHandler([t,o].concat(c))}else s=ue({},o);s.lng=s.lng||e.lng,s.lngs=s.lngs||e.lngs,s.ns=s.ns||e.ns;var u=i.options.keySeparator||".",h=n?"".concat(n).concat(u).concat(t):t;return i.t(h,s)};return"string"==typeof e?o.lng=e:o.lngs=e,o.ns=t,o.keyPrefix=n,o}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var r=this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,o=this.languages[this.languages.length-1];if("cimode"===r.toLowerCase())return!0;var s=function(e,n){var r=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===r||2===r};if(n.precheck){var a=n.precheck(this,s);if(void 0!==a)return a}return!!this.hasResourceBundle(r,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!s(r,e)||i&&!s(o,e)))}},{key:"loadNamespaces",value:function(e,t){var n=this,r=x();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=x();"string"==typeof e&&(e=[e]);var r=this.options.preload||[],i=e.filter((function(e){return r.indexOf(e)<0}));return i.length?(this.options.preload=r.concat(i),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:pe,i=ue(ue(ue({},this.options),t),{isClone:!0}),o=new n(i);return["store","services","language"].forEach((function(t){o[t]=e[t]})),o.services=ue({},this.services),o.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o.translator=new z(o.services,o.options),o.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];o.emit.apply(o,[e].concat(n))})),o.init(i,r),o.translator.options=o.options,o.translator.backendConnector.services.utils={hasLoadedNamespace:o.hasLoadedNamespace.bind(o)},o}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),n}(k);d(de,"createInstance",(function(){return new de(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}));var fe=de.createInstance();fe.createInstance=de.createInstance;fe.createInstance,fe.init,fe.loadResources,fe.reloadResources,fe.use,fe.changeLanguage,fe.getFixedT,fe.t,fe.exists,fe.setDefaultNamespace,fe.hasLoadedNamespace,fe.loadNamespaces,fe.loadLanguages;var ge=fe,me=[],ye=me.forEach,ve=me.slice;function be(e,t){if(t&&"object"===r(t)){var n="",i=encodeURIComponent;for(var o in t)n+="&"+i(o)+"="+i(t[o]);if(!n)return e;e=e+(-1!==e.indexOf("?")?"&":"?")+n.slice(1)}return e}function we(e,t,n,i,o){i&&"object"===r(i)&&(o||(i._t=new Date),i=be("",i).slice(1)),t.queryStringParams&&(e=be(e,t.queryStringParams));try{var s;(s=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP.3.0")).open(i?"POST":"GET",e,1),t.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.withCredentials=!!t.withCredentials,i&&s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.overrideMimeType&&s.overrideMimeType("application/json");var a=t.customHeaders;if(a="function"==typeof a?a():a)for(var c in a)s.setRequestHeader(c,a[c]);s.onreadystatechange=function(){s.readyState>3&&n&&n(s.responseText,s)},s.send(i)}catch(e){console&&console.log(e)}}var ke=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i(this,e),this.init(t,n),this.type="backend"}return a(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.services=e,this.options=function(e){return ye.call(ve.call(arguments,1),(function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])})),e}(t,this.options||{},{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:JSON.parse,parsePayload:function(e,t,n){return d({},t,n||"")},crossDomain:!1,ajax:we})}},{key:"readMulti",value:function(e,t,n){var r=this.options.loadPath;"function"==typeof this.options.loadPath&&(r=this.options.loadPath(e,t));var i=this.services.interpolator.interpolate(r,{lng:e.join("+"),ns:t.join("+")});this.loadUrl(i,n)}},{key:"read",value:function(e,t,n){var r=this.options.loadPath;"function"==typeof this.options.loadPath&&(r=this.options.loadPath([e],[t]));var i=this.services.interpolator.interpolate(r,{lng:e,ns:t});this.loadUrl(i,n)}},{key:"loadUrl",value:function(e,t){var n=this;this.options.ajax(e,this.options,(function(r,i){if(i.status>=500&&i.status<600)return t("failed loading "+e,!0);if(i.status>=400&&i.status<500)return t("failed loading "+e,!1);var o,s;try{o=n.options.parse(r,e)}catch(t){s="failed parsing "+e+" to json"}if(s)return t(s,!1);t(null,o)}))}},{key:"create",value:function(e,t,n,r){var i=this;"string"==typeof e&&(e=[e]);var o=this.options.parsePayload(t,n,r);e.forEach((function(e){var n=i.services.interpolator.interpolate(i.options.addPath,{lng:e,ns:t});i.options.ajax(n,i.options,(function(e,t){}),o)}))}}]),e}();ke.type="backend";var xe=ke,Se=n(1815);class Oe extends Se.ZP{constructor(e,t){super(e),this.detail=t}}var Me=()=>{const e=window.navigator.userAgent.toLowerCase();try{let t;return-1!=e.indexOf("chrome")?(t=(navigator.languages[0]||navigator.browserLanguage||navigator.language||navigator.userLanguage).split(";"),t[0]):(t=(navigator.browserLanguage||navigator.language||navigator.userLanguage).split(";"),t[0])}catch(e){return""}};const Pe=["ALL","OFF"],_e={ALL:-99,DEBUG:-1,INFO:0,WARN:1,ERROR:2,OFF:99};class Ae{constructor(e=_e.INFO){this.level=e,this.make()}make(){const e=Object.keys(_e).filter((e=>!Pe.includes(e)));for(const t of e){const e=_e[t];this[t.toLowerCase()]=this.level<=e?console.log:()=>{}}}}var je=n(4352);const Ee=20037508.342789244,Le=[[0,0],[0,1],[1,0],[0,-1],[-1,0]],Ie="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAMAAABrrFhUAAAAB3RJTUUH3QgIBToaSbAjlwAAABd0RVh0U29mdHdhcmUAR0xEUE5HIHZlciAzLjRxhaThAAAACHRwTkdHTEQzAAAAAEqAKR8AAAAEZ0FNQQAAsY8L/GEFAAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAAFRJREFUeNrtwQEBAAAAgJD+r+4ICgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABgBDwABHHIJwwAAAABJRU5ErkJggg==",Ce=256,De=`<canvas width="256" height="256" src="${Ie}"></canvas>`;async function Te(e){return"string"==typeof e?new Promise(((t,n)=>{const r=e.match(/\//)?e:`pois/${e}`,i=new XMLHttpRequest;i.open("GET",r,!0),i.responseType="json",i.onload=function(e){if(200==this.status||0==this.status)try{let e=this.response;"string"==typeof e&&(e=JSON.parse(e)),t(e)}catch(e){n(e)}else n("Fail to load poi json")},i.send()})):e}async function Re(e,t){if(e=await Te(e),Array.isArray(e))e=(e=await Promise.all(e.map((async e=>await Te(e))))).length>0&&"FeatureCollection"===e[0].type?e.reduce(((e,n,r)=>{let i=n.id||n.properties&&n.properties.id;if(!i){if(0!==r)throw"POI layers include bad key setting";i="main"}return e[i]=Ze(n,i,t),e}),{}):{main:Ze(e,"main",t)};else if("FeatureCollection"===e.type){const n=e.id||e.properties&&e.properties.id||"main";e={[n]:Ze(e,n,t)}}else Object.keys(e).map((n=>{e[n]=Ze(e[n],n,t)}));return e.main||(e.main=Ze([],"main",t)),Object.keys(e).map((n=>{Fe(e,n,t)})),e}function Ze(e,t,n){if(Array.isArray(e))e={pois:e.map((e=>Be(e)))};else if("FeatureCollection"===e.type){const t=Object.assign({},e.properties||{});e.name&&(t.name=e.name),t.pois=e.features.map((e=>Be(e))),e=t}if(void 0===e.id)e.id=t;else if(e.id!==t)throw"POI layers include bad key setting";return e.namespaceID||(e.namespaceID=`${n.namespace?`${n.namespace}#`:""}${t}`),e.name||(e.name="main"===t?n.name:t),e.pois||(e.pois=[]),e}function Be(e){if("Feature"===e.type){const t=Object.assign({},e.properties||{});t.lnglat=e.geometry.coordinates,t.id||(t.id=e.id),t.name||(t.name=e.name),e=t}return e.lnglat||(e.lnglat=[e.lng||e.longitude,e.lat||e.latitude]),delete e.lng,delete e.lat,delete e.longitude,delete e.latitude,e}function Fe(e,t,n){if(!e[t])return;const r=e[t],i=r.pois;r.__nextId||(r.__nextId=0),i.map((e=>{e.id||(e.id=`${t}_${r.__nextId}`,r.__nextId++),e.namespaceID||(e.namespaceID=`${n.namespace?`${n.namespace}#`:""}${e.id}`)}))}var Ne=n(9444),Ue=n(9213);function Ve(e){return class extends e{constructor(){super(...arguments),this.officialTitle="",this.title="",this.mapID="",this.label="",this.homeMarginPixels=0}getCacheEnable(){return!!this.weiwudi}async getTileCacheStatsAsync(){if(!this.weiwudi)return{};try{return await this.weiwudi.stats()}catch(e){return{}}}async getTileCacheSizeAsync(){return(await this.getTileCacheStatsAsync()).size||0}async fetchAllTileCacheAsync(e){if(this.weiwudi)try{const t=t=>{e(t.type,t.detail)},n=e=>{this.weiwudi.removeEventListener("proceed",t),this.weiwudi.removeEventListener("finish",n),this.weiwudi.removeEventListener("stop",n),this.weiwudi.removeEventListener("canceled",n),t(e)};this.weiwudi.addEventListener("proceed",t),this.weiwudi.addEventListener("finish",n),this.weiwudi.addEventListener("stop",n),this.weiwudi.addEventListener("canceled",n),await this.weiwudi.fetchAll()}catch(e){}}async cancelTileCacheAsync(){if(this.weiwudi)try{await this.weiwudi.cancel()}catch(e){}}async clearTileCacheAsync(){if(this.weiwudi)try{await this.weiwudi.clean()}catch(e){}}getMap(){return this._map}setMap(e){this._map=e}setViewpointRadian(e){let t,n;const r=e.mercZoom,i=e.zoom,o=e.direction,s=e.rotation,a=this.getMap(),c=null==a?void 0:a.getView();void 0!==e.latitude&&void 0!==e.longitude&&(t=(0,je.vs)([e.longitude,e.latitude],"EPSG:4326","EPSG:3857")),void 0!==e.x&&null!=e.y&&(n=[e.x,e.y]),this.viewpoint2MercsAsync().then((e=>this.mercs2MercViewpoint(e))).then((e=>{const a=this.mercViewpoint2Mercs([t||e[0],r||e[1]||17,null!==o?o:e[2]]);this.mercs2ViewpointAsync(a).then((e=>{null!=t?null==c||c.setCenter(e[0]):null!=n&&(null==c||c.setCenter(n)),null!=r?null==c||c.setZoom(e[1]):null!=i&&(null==c||c.setZoom(i)),null!=o?null==c||c.setRotation(e[2]):null!=s&&(null==c||c.setRotation(s))}))}))}setViewpoint(e){e.rotation&&(e.rotation=e.rotation*Math.PI/180),e.direction&&(e.direction=e.direction*Math.PI/180),this.setViewpointRadian(e)}goHome(){const e=this.getMap();let t=e.getTarget();"string"==typeof t&&(t=document.getElementById(t));const n=e.homeMarginPixels,r=[1*(t.clientWidth-n-10),1*(t.clientHeight-n-10)],i={longitude:this.homePosition[0],latitude:this.homePosition[1],zoom:this.defZoom(r)};this.getMap().northUp?i.direction=0:i.rotation=0,this.setViewpointRadian(i)}resetRotation(){this.setViewpointRadian({rotation:0})}resetDirection(){this.setViewpointRadian({direction:0})}resetCirculation(){this.getMap().northUp?this.resetDirection():this.resetRotation()}setGPSMarkerAsync(e,t=!1){const n=this.getMap(),r=null==n?void 0:n.getView();if(!e)return new Promise(((e,t)=>{null==n||n.setGPSPosition(null),e(!0)}));const i=this.mercsFromGPSValue(e.lnglat,e.acc);return this.mercs2SysCoordsAsync_multiLayer([i]).then((e=>{const i=!e[0],o=i?e[1]:e[0],s=i?null:e[1],a={xy:o[0][0]};if(!this.insideCheckSysCoord(o[0][0]))return null==n||n.handleGPS(!1,!0),!1;const c=o[0].slice(1);return a.rad=c.reduce(((e,t,n)=>{const r=e+Math.sqrt(Math.pow(t[0]-a.xy[0],2)+Math.pow(t[1]-a.xy[1],2));return 3===n?r/4:r}),0),t||null==r||r.setCenter(a.xy),null==n||n.setGPSPosition(a,i?"hide":null),s&&(null==n||n.setGPSPosition({xy:s[0][0]},"sub")),!0})).catch((e=>{throw e}))}setGPSMarker(e,t=!1){this.setGPSMarkerAsync(e,t).then((()=>{}))}mercsFromGPSValue(e,t){const n=(0,je.vs)(e,"EPSG:4326","EPSG:3857"),r=e[1]*Math.PI/180,i=t/Math.cos(r);return Le.map((e=>[e[0]*i+n[0],e[1]*i+n[1]]))}rotateMatrix(e,t){void 0===t&&(t=this.getMap().getView().getRotation());const n=[];for(let r=0;r<e.length;r++){const i=e[r],o=i[0]*Math.cos(t)-i[1]*Math.sin(t),s=i[0]*Math.sin(t)+i[1]*Math.cos(t);n.push([o,s])}return n}async resolvePois(e){this.pois=await Re(e||[],{name:this.officialTitle||this.title,namespace:this.mapID})}getPoi(e){let t;return Object.keys(this.pois).map((n=>{this.pois[n].pois.map(((r,i)=>{r.id===e&&(t=this.pois[n].pois[i])}))})),t}addPoi(e,t){if(t||(t="main"),this.pois[t])return e=Be(e),this.pois[t].pois.push(e),Fe(this.pois,t,{name:this.officialTitle||this.title,namespace:this.mapID}),e.namespaceID}removePoi(e){Object.keys(this.pois).map((t=>{this.pois[t].pois.map(((n,r)=>{n.id===e&&delete this.pois[t].pois[r]}))}))}clearPoi(e){e||(e="main"),"all"===e?Object.keys(this.pois).map((e=>{this.pois[e].pois=[]})):this.pois[e]&&(this.pois[e].pois=[])}listPoiLayers(e=!1,t=!1){return Object.keys(this.pois).sort(((e,t)=>"main"===e?-1:"main"===t?1:e<t?-1:e>t?1:0)).map((e=>this.pois[e])).filter((n=>t?e?n.pois.length&&n.hide:n.pois.length:!e||n.hide))}getPoiLayer(e){return this.pois[e]}addPoiLayer(e,t){"main"!==e&&(this.pois[e]||(this.pois[e]=Ze(t||[],e,{name:this.officialTitle||this.title,namespace:this.mapID})))}removePoiLayer(e){"main"!==e&&this.pois[e]&&delete this.pois[e]}merc2SysCoordAsync_ignoreBackground(e){return this.merc2XyAsync_ignoreBackground(e).then((e=>e?this.xy2SysCoord(e):void 0))}merc2SysCoordAsync(e){return this.merc2XyAsync(e).then((e=>e?this.xy2SysCoord(e):e))}sysCoord2MercAsync(e){const t=this.sysCoord2Xy(e);return this.xy2MercAsync(t)}zoom2Radius(e,t){const n=Math.floor(Math.min(e[0],e[1])/4);return void 0===t&&(t=this.getMap().getView().getDecimalZoom()),n*Ee/128/Math.pow(2,t)}viewpoint2SysCoords(e,t){return this.mercViewpoint2Mercs(e,t)}mercViewpoint2Mercs(e,t){let n=e?e[0]:void 0;const r=e?e[1]:void 0,i=e?e[2]:void 0;void 0===n&&(n=this.getMap().getView().getCenter()),void 0===t&&(t=this.getMap().getSize());const o=this.zoom2Radius(t,r);return[this.rotateMatrix(Le,i).map((e=>[e[0]*o+n[0],e[1]*o+n[1]])),t]}sysCoords2Viewpoint(e){return this.mercs2MercViewpoint(e)}mercs2MercViewpoint(e){const t=e[0][0];let n=e[1];const r=e[0].slice(1,5).map((e=>[e[0]-t[0],e[1]-t[1]])),i=[[0,1],[1,0],[0,-1],[-1,0]];let o=0,s=0,a=0;for(let e=0;e<4;e++){const t=r[e],n=i[e],c=Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],2));o+=c;const l=t[0]*n[1]-t[1]*n[0],u=Math.acos((t[0]*n[0]+t[1]*n[1])/c),h=l>0?-1*u:u;s+=Math.cos(h),a+=Math.sin(h)}const c=o/4,l=Math.atan2(a,s);n||(n=this.getMap().getSize());const u=Math.floor(Math.min(n[0],n[1])/4),h=Math.log(u*Ee/128/c)/Math.log(2);return[t,h,l]}sysCoords2Xys(e){return[e[0].map((e=>this.sysCoord2Xy(e))),e[1]]}xys2SysCoords(e){return[e[0].map((e=>this.xy2SysCoord(e))),e[1]]}mercs2XysAsync(e){return Promise.all(e[0].map((e=>this.merc2XyAsync(e)))).then((t=>[t,e[1]]))}xys2MercsAsync(e){return Promise.all(e[0].map((e=>this.xy2MercAsync(e)))).then((t=>[t,e[1]]))}}}const $e=["title","officialTitle","author","createdAt","era","contributor","mapper","license","dataLicense","attr","dataAttr","reference","description"],ze=["title","official_title","author","created_at","era","contributor","mapper","license","data_license","attr","data_attr","reference","description"];function qe(e,t){var n;if(t=Ke(t),e.mapID=t.mapID,e.homePosition=t.homePosition,e.mercZoom=t.mercZoom,e.label=t.label,e.maxZoom=t.maxZoom,e.minZoom=t.minZoom,e.poiTemplate=t.poiTemplate,e.poiStyle=t.poiStyle,e.iconTemplate=t.iconTemplate,e.icon=t.icon,e.selectedIcon=t.selectedIcon,e.mercatorXShift=t.mercatorXShift,e.mercatorYShift=t.mercatorYShift,e.weiwudi=t.weiwudi,t.envelopeLngLats){const r=t.envelopeLngLats.map((e=>(0,je.vs)(e,"EPSG:4326","EPSG:3857")));r.push(r[0]),e.envelope=(0,Ne.yu)([r]),e.centroid=null===(n=(0,Ue.Z)(e.envelope).geometry)||void 0===n?void 0:n.coordinates}for(let n=0;n<$e.length;n++){const r=$e[n],i=ze[n];e[r]=t[i]||t[r]}const r=t.thumbnail?new Promise((n=>{e.thumbnail=t.thumbnail,n(void 0)})):new Promise((n=>{e.thumbnail=`./tmbs/${t.mapID}.jpg`,fetch(e.thumbnail).then((r=>{r.ok||(e.thumbnail=`./tmbs/${t.mapID}_menu.jpg`),n(void 0)})).catch((r=>{e.thumbnail=`./tmbs/${t.mapID}_menu.jpg`,n(void 0)}))})).catch((n=>{e.thumbnail=`./tmbs/${t.mapID||t.sourceID}_menu.jpg`})),i=e.resolvePois(t.pois);e.initialWait=Promise.all([i,r])}function Ge(e){const t=e;e.setTileLoadFunction(function(){const e=t.getTileLoadFunction();return function(n,r){const i=n.tileCoord[0];let o=n.tileCoord[1],s=n.tileCoord[2],a=Math.round(128*(t.mercatorXShift||0)*Math.pow(2,i)/Ee),c=Math.round(-128*(t.mercatorYShift||0)*Math.pow(2,i)/Ee);for(;a<0||a>=256;)a<0?(a+=256,o++):(a-=256,o--);for(;c<0||c>=256;)c<0?(c+=256,s++):(c-=256,s--);const l=document.createElement("div");l.innerHTML=De;const u=l.childNodes[0],h=[[[i,o,s],0,0,256-a,256-c]];0!==a&&h.push([[i,o-1,s],256-a,0,a,256-c]),0!==c&&(h.push([[i,o,s-1],0,256-c,256-a,c]),0!==a&&h.push([[i,o-1,s-1],256-a,256-c,a,c])),Promise.all(h.map((e=>{const n=t.tileUrlFunction(e[0],t.tilePixelRatio_,t.projection_);return function(e,t,n,r,i,o,s){return new Promise(((e,a)=>{const c=function(t,a=void 0){0;const l=document.createElement("img");l.crossOrigin="Anonymous",l.onload=l.onerror=function(){if(l.width&&l.height){const t=n.getContext("2d"),a=0===r?256-o:0,c=0===i?256-s:0;o=r+o>l.width?l.width-r:o,s=i+s>l.height?l.height-i:s,t.drawImage(l,r,i,o,s,a,c,o,s),e(void 0)}else a?c(a):e("tileLoadError");0},l.src=t};c(t)}))}(e[0],n,u,e[1],e[2],e[3],e[4])}))).then((t=>{if(t.reduce(((e,t)=>e&&t),!0))n.handleImageError_();else{const t=u.toDataURL();n.getImage().crossOrigin=null,e(n,t)}})).catch((e=>{n.handleImageError_()}))}}())}function Xe(e){const t=document,n=t.createDocumentFragment(),r=[];e=e.replace(/(<\/?)d([ >])/g,"$1div$2").replace(/(<\/?)s([ >])/g,"$1span$2").replace(/ din="/g,' data-i18n="').replace(/ dinh="/g,' data-i18n-html="').replace(/ c="/g,' class="');const i=n.appendChild(t.createElement("div"));i.innerHTML=e;for(let e=0;e<i.childNodes.length;e++){const n=i.childNodes[e];if(n.nodeName&&"script"===n.nodeName.toLowerCase()){const i=t.createElement("script");n.type&&(i.type=n.type),n.src?i.src=n.src:i.text=n.text,r[e]=i}else r[e]=n}return r}function He(e){for(;!(e<=180&&e>-180);){e+=360*(e>0?-1:1)}return e}function Je(e){if(!e)return;const t={mapID:e.mapID};for(let n=0;n<$e.length;n++){const r=$e[n];e[r]&&(t[r]=e[r])}return t}function Ke(e){const t={max_zoom:"maxZoom",min_zoom:"minZoom",envelope_lnglats:"envelopeLngLats",envelopLngLats:"envelopeLngLats",image_extention:"imageExtension",image_extension:"imageExtension",imageExtention:"imageExtension",map_id:"mapID",sourceID:"mapID",source_id:"mapID",merc_max_zoom:"mercMaxZoom",merc_min_zoom:"mercMinZoom",zoom_restriction:"zoomRestriction",enable_cache:"enableCache",default_zoom:"defaultZoom",start_from:"startFrom",home_position:"homePosition",fake_radius:"fakeRadius",fake_center:"fakeCenter",fake_gps:"fakeGps",app_name:"appName",setting_file:"settingFile",merc_zoom:"mercZoom",mapbox_token:"mapboxToken",translate_ui:"translateUI",restore_session:"restoreSession",no_rotate:"noRotate",poi_template:"poiTemplate",poi_style:"poiStyle",icon_template:"iconTemplate",default_center:"defaultCenter",default_rotation:"defaultRotation",selected_icon:"selectedIcon",namespace_id:"namespaceID",mercator_x_shift:"mercatorXShift",mercator_y_shift:"mercatorYShift"};return Object.keys(t).reduce(((e,n)=>(e[n]&&(e[t[n]]=e[n],delete e[n]),e)),e)}var Ye=n(8022),We=n(4907),Qe=n(4448),et=n(6331),tt=n(7059),nt=n(9810);const rt="accuracy",it="accuracyGeometry",ot="altitude",st="altitudeAccuracy",at="heading",ct="position",lt="projection",ut="speed",ht="tracking",pt="trackingOptions",dt="error";class ft extends Se.ZP{constructor(e){super(dt),this.code=e.code,this.message=e.message}}class gt extends et.Z{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=je.gD,this.watchId_=void 0,this.addChangeListener(lt,this.handleProjectionChanged_),this.addChangeListener(ht,this.handleTrackingChanged_),void 0!==e.projection&&this.setProjection(e.projection),void 0!==e.trackingOptions&&this.setTrackingOptions(e.trackingOptions),this.setTracking(void 0!==e.tracking&&e.tracking)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=(0,je.WO)((0,je.U2)("EPSG:4326"),e),this.position_&&this.set(ct,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&void 0===this.watchId_?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):e||void 0===this.watchId_||(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(rt,t.accuracy),this.set(ot,null===t.altitude?void 0:t.altitude),this.set(st,null===t.altitudeAccuracy?void 0:t.altitudeAccuracy),this.set(at,null===t.heading?void 0:(0,nt.Yr)(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const n=this.transform_(this.position_);this.set(ct,n.slice()),this.set(ut,null===t.speed?void 0:t.speed);const r=(0,tt.iu)(this.position_,t.accuracy);r.applyTransform(this.transform_),this.set(it,r),this.changed()}positionError_(e){this.dispatchEvent(new ft(e))}getAccuracy(){return this.get(rt)}getAccuracyGeometry(){return this.get(it)||null}getAltitude(){return this.get(ot)}getAltitudeAccuracy(){return this.get(st)}getHeading(){return this.get(at)}getPosition(){return this.get(ct)}getProjection(){return this.get(lt)}getSpeed(){return this.get(ut)}getTracking(){return this.get(ht)}getTrackingOptions(){return this.get(pt)}setProjection(e){this.set(lt,(0,je.U2)(e))}setTracking(e){this.set(ht,e)}setTrackingOptions(e){this.set(pt,e)}}var mt=gt,yt=n(9084),vt=n(1831);vt.ZP.prototype.getDecimalZoom=function(){const e=this.getResolution(),t=Math.log(this.maxResolution_/e)/Math.log(2);return void 0!==t?this.minZoom_+t:t};var bt=n(401),wt=n(5598),kt=n(9950),xt=n(1825),St=n(7396),Ot=n(1456),Mt=n(4287),Pt=n(3254),_t=n(8354),At=n(7770),jt=n(5758),Et=n(7705),Lt=n(1878);class It extends xt.Z{constructor(e){super(e),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,jt.lJ)(),this.tmpTileRange_=new Mt.Z(0,0,0,0)}isDrawableTile(e){const t=this.getLayer(),n=e.getState(),r=t.getUseInterimTilesOnError();return n==Pt.Z.LOADED||n==Pt.Z.EMPTY||n==Pt.Z.ERROR&&!r}getTile(e,t,n,r){const i=r.pixelRatio,o=r.viewState.projection,s=this.getLayer();let a=s.getSource().getTile(e,t,n,i,o);return a.getState()==Pt.Z.ERROR&&s.getUseInterimTilesOnError()&&s.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(a)||(a=a.getInterimTile()),a}getData(e){const t=this.frameState;if(!t)return null;const n=this.getLayer(),r=(0,_t.nn)(t.pixelToCoordinateTransform,e.slice()),i=n.getExtent();if(i&&!(0,jt.b8)(i,r))return null;const o=t.pixelRatio,s=t.viewState.projection,a=t.viewState,c=n.getRenderSource(),l=c.getTileGridForProjection(a.projection),u=c.getTilePixelRatio(t.pixelRatio);for(let e=l.getZForResolution(a.resolution);e>=l.getMinZoom();--e){const t=l.getTileCoordForCoordAndZ(r,e),n=c.getTile(e,t[1],t[2],o,s);if(!(n instanceof St.Z||n instanceof Ot.Z)||n instanceof Ot.Z&&n.getState()===Pt.Z.EMPTY)return null;if(n.getState()!==Pt.Z.LOADED)continue;const i=l.getOrigin(e),h=(0,Lt.Pq)(l.getTileSize(e)),p=l.getResolution(e),d=Math.floor(u*((r[0]-i[0])/p-t[1]*h[0])),f=Math.floor(u*((i[1]-r[1])/p-t[2]*h[1])),g=Math.round(u*c.getGutterForProjection(a.projection));return this.getImageData(n.getImage(),d+g,f+g)}return null}loadedTileCallback(e,t,n){return!!this.isDrawableTile(n)&&super.loadedTileCallback(e,t,n)}prepareFrame(e){return!!this.getLayer().getSource()}renderFrame(e,t){const n=e.layerStatesArray[e.layerIndex],r=e.viewState,i=r.projection,o=r.resolution,s=r.center,a=r.rotation,c=e.pixelRatio,l=this.getLayer(),u=l.getSource(),h=u.getRevision(),p=u.getTileGridForProjection(i),d=p.getZForResolution(o,u.zDirection),f=p.getResolution(d);let g=e.extent;const m=e.viewState.resolution,y=u.getTilePixelRatio(c),v=Math.round((0,jt.dz)(g)/m*c),b=Math.round((0,jt.Cr)(g)/m*c),w=n.extent&&(0,je.dY)(n.extent,i);w&&(g=(0,jt.Ed)(g,(0,je.dY)(n.extent,i)));const k=f*v/2/y,x=f*b/2/y,S=[s[0]-k,s[1]-x,s[0]+k,s[1]+x],O=p.getTileRangeForExtentAndZ(g,d),M={};M[d]={};const P=this.createLoadedTileFinder(u,i,M),_=this.tmpExtent,A=this.tmpTileRange_;this.newTiles_=!1;const j=a?(0,jt.dY)(r.center,m,a,e.size):void 0;for(let t=O.minX;t<=O.maxX;++t)for(let r=O.minY;r<=O.maxY;++r){if(a&&!p.tileCoordIntersectsViewport([d,t,r],j))continue;const i=this.getTile(d,t,r,e);if(this.isDrawableTile(i)){const t=(0,Et.sq)(this);if(i.getState()==Pt.Z.LOADED){M[d][i.tileCoord.toString()]=i;let e=i.inTransition(t);e&&1!==n.opacity&&(i.endTransition(t),e=!1),this.newTiles_||!e&&this.renderedTiles.includes(i)||(this.newTiles_=!0)}if(1===i.getAlpha(t,e.time))continue}const o=p.getTileCoordChildTileRange(i.tileCoord,A,_);let s=!1;o&&(s=P(d+1,o)),s||p.forEachTileCoordParentTileRange(i.tileCoord,P,A,_)}const E=f/o*c/y;(0,_t.qC)(this.pixelTransform,e.size[0]/2,e.size[1]/2,1/c,1/c,a,-v/2,-b/2);const L=(0,_t.BB)(this.pixelTransform);this.useContainer(t,L,this.getBackground(e));const I=this.context,C=I.canvas;(0,_t.nb)(this.inversePixelTransform,this.pixelTransform),(0,_t.qC)(this.tempTransform,v/2,b/2,E,E,0,-v/2,-b/2),C.width!=v||C.height!=b?(C.width=v,C.height=b):this.containerReused||I.clearRect(0,0,v,b),w&&this.clipUnrotated(I,e,w),u.getInterpolate()||(I.imageSmoothingEnabled=!1),this.preRender(I,e),this.renderedTiles.length=0;let D,T,R,Z=Object.keys(M).map(Number);Z.sort(At.j2),1!==n.opacity||this.containerReused&&!u.getOpaque(e.viewState.projection)?(D=[],T=[]):Z=Z.reverse();for(let t=Z.length-1;t>=0;--t){const n=Z[t],r=u.getTilePixelSize(n,c,i),o=p.getResolution(n)/f,s=r[0]*o*E,a=r[1]*o*E,l=p.getTileCoordForCoordAndZ((0,jt.rL)(S),n),h=p.getTileCoordExtent(l),g=(0,_t.nn)(this.tempTransform,[y*(h[0]-S[0])/f,y*(S[3]-h[3])/f]),m=y*u.getGutterForProjection(i),v=M[n];for(const t in v){const r=v[t],i=r.tileCoord,o=l[1]-i[1],c=Math.round(g[0]-(o-1)*s),h=l[2]-i[2],p=Math.round(g[1]-(h-1)*a),f=Math.round(g[0]-o*s),y=Math.round(g[1]-h*a),b=c-f,w=p-y,k=d===n,x=k&&1!==r.getAlpha((0,Et.sq)(this),e.time);let S=!1;if(!x)if(D){R=[f,y,f+b,y,f+b,y+w,f,y+w];for(let e=0,t=D.length;e<t;++e)if(d!==n&&n<T[e]){const t=D[e];(0,jt.kK)([f,y,f+b,y+w],[t[0],t[3],t[4],t[7]])&&(S||(I.save(),S=!0),I.beginPath(),I.moveTo(R[0],R[1]),I.lineTo(R[2],R[3]),I.lineTo(R[4],R[5]),I.lineTo(R[6],R[7]),I.moveTo(t[6],t[7]),I.lineTo(t[4],t[5]),I.lineTo(t[2],t[3]),I.lineTo(t[0],t[1]),I.clip())}D.push(R),T.push(n)}else I.clearRect(f,y,b,w);this.drawTileImage(r,e,f,y,b,w,m,k),D&&!x?(S&&I.restore(),this.renderedTiles.unshift(r)):this.renderedTiles.push(r),this.updateUsedTiles(e.usedTiles,u,r)}}return this.renderedRevision=h,this.renderedResolution=f,this.extentChanged=!this.renderedExtent_||!(0,jt.fS)(this.renderedExtent_,S),this.renderedExtent_=S,this.renderedPixelRatio=c,this.renderedProjection=i,this.manageTilePyramid(e,u,p,c,i,g,d,l.getPreload()),this.scheduleExpireCache(e,u),this.postRender(I,e),n.extent&&I.restore(),I.imageSmoothingEnabled=!0,L!==C.style.transform&&(C.style.transform=L),this.container}drawTileImage(e,t,n,r,i,o,s,a){const c=this.getTileImage(e);if(!c)return;const l=(0,Et.sq)(this),u=t.layerStatesArray[t.layerIndex],h=u.opacity*(a?e.getAlpha(l,t.time):1),p=h!==this.context.globalAlpha;p&&(this.context.save(),this.context.globalAlpha=h),this.context.drawImage(c,s,s,c.width-2*s,c.height-2*s,n,r,i,o),p&&this.context.restore(),h!==u.opacity?t.animate=!0:a&&e.endTransition(l)}getImage(){const e=this.context;return e?e.canvas:null}getTileImage(e){return e.getImage()}scheduleExpireCache(e,t){if(t.canExpireCache()){const n=function(e,t,n){const r=(0,Et.sq)(e);r in n.usedTiles&&e.expireCache(n.viewState.projection,n.usedTiles[r])}.bind(null,t);e.postRenderFunctions.push(n)}}updateUsedTiles(e,t,n){const r=(0,Et.sq)(t);r in e||(e[r]={}),e[r][n.getKey()]=!0}manageTilePyramid(e,t,n,r,i,o,s,a,c){const l=(0,Et.sq)(t);l in e.wantedTiles||(e.wantedTiles[l]={});const u=e.wantedTiles[l],h=e.tileQueue,p=n.getMinZoom(),d=e.viewState.rotation,f=d?(0,jt.dY)(e.viewState.center,e.viewState.resolution,d,e.size):void 0;let g,m,y,v,b,w,k=0;for(w=p;w<=s;++w)for(m=n.getTileRangeForExtentAndZ(o,w,m),y=n.getResolution(w),v=m.minX;v<=m.maxX;++v)for(b=m.minY;b<=m.maxY;++b)d&&!n.tileCoordIntersectsViewport([w,v,b],f)||(s-w<=a?(++k,g=t.getTile(w,v,b,r,i),g.getState()==Pt.Z.IDLE&&(u[g.getKey()]=!0,h.isKeyQueued(g.getKey())||h.enqueue([g,l,n.getTileCoordCenter(g.tileCoord),y])),void 0!==c&&c(g)):t.useTile(w,v,b,i));t.updateCacheSize(k,i)}}var Ct=It;class Dt extends kt.Z{constructor(e){super(e)}createRenderer(){return new Ct(this)}}var Tt=Dt,Rt=n(9615),Zt=n(8017),Bt=n(9324),Ft=n(8283),Nt=n(68);class Ut extends Bt.ZP{constructor(e,t,n){super(),void 0!==n&&void 0===t?this.setFlatCoordinates(n,e):(t=t||0,this.setCenterAndRadius(e,t,n))}clone(){const e=new Ut(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,n,r){const i=this.flatCoordinates,o=e-i[0],s=t-i[1],a=o*o+s*s;if(a<r){if(0===a)for(let e=0;e<this.stride;++e)n[e]=i[e];else{const e=this.getRadius()/Math.sqrt(a);n[0]=i[0]+e*o,n[1]=i[1]+e*s;for(let e=2;e<this.stride;++e)n[e]=i[e]}return n.length=this.stride,a}return r}containsXY(e,t){const n=this.flatCoordinates,r=e-n[0],i=t-n[1];return r*r+i*i<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,n=t[this.stride]-t[0];return(0,jt.T9)(t[0]-n,t[1]-n,t[0]+n,t[1]+n,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if((0,jt.kK)(e,t)){const t=this.getCenter();return e[0]<=t[0]&&e[2]>=t[0]||(e[1]<=t[1]&&e[3]>=t[1]||(0,jt.H6)(e,this.intersectsCoordinate.bind(this)))}return!1}setCenter(e){const t=this.stride,n=this.flatCoordinates[t]-this.flatCoordinates[0],r=e.slice();r[t]=r[0]+n;for(let n=1;n<t;++n)r[t+n]=e[n];this.setFlatCoordinates(this.layout,r),this.changed()}setCenterAndRadius(e,t,n){this.setLayout(n,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const r=this.flatCoordinates;let i=(0,Ft.IG)(r,0,e,this.stride);r[i++]=r[0]+t;for(let e=1,t=this.stride;e<t;++e)r[i++]=r[e];r.length=i,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const n=this.getCenter(),r=this.getStride();this.setCenter((0,Nt.U1)(n,0,n.length,r,e,t,n)),this.changed()}}Ut.prototype.transform;var Vt=Ut,$t=n(1761),zt=n(5509),qt=n(7844),Gt=n(6451),Xt=n(7513),Ht=n(452);class Jt extends Ht.Z{constructor(e){let t;t=void 0!==(e=e||{}).attributions?e.attributions:['&#169; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> contributors.'];const n=void 0!==e.crossOrigin?e.crossOrigin:"anonymous",r=void 0!==e.url?e.url:"https://tile.openstreetmap.org/{z}/{x}/{y}.png";super({attributions:t,attributionsCollapsible:!1,cacheSize:e.cacheSize,crossOrigin:n,interpolate:e.interpolate,maxZoom:void 0!==e.maxZoom?e.maxZoom:19,opaque:void 0===e.opaque||e.opaque,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:r,wrapX:e.wrapX,zDirection:e.zDirection})}}var Kt=Jt,Yt=n(1758);function Wt(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=(0,Yt.c9)(e),i=(0,Yt.wA)(t),o=i.type,s=t.bbox,a=i.coordinates;if(s&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,s))return!1;"Polygon"===o&&(a=[a]);for(var c=!1,l=0;l<a.length&&!c;l++)if(Qt(r,a[l][0],n.ignoreBoundary)){for(var u=!1,h=1;h<a[l].length&&!u;)Qt(r,a[l][h],!n.ignoreBoundary)&&(u=!0),h++;u||(c=!0)}return c}function Qt(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var i=0,o=t.length-1;i<t.length;o=i++){var s=t[i][0],a=t[i][1],c=t[o][0],l=t[o][1];if(e[1]*(s-c)+a*(c-e[0])+l*(e[0]-s)==0&&(s-e[0])*(c-e[0])<=0&&(a-e[1])*(l-e[1])<=0)return!n;a>e[1]!=l>e[1]&&e[0]<(c-s)*(e[1]-a)/(l-a)+s&&(r=!r)}return r}var en=n(7991);class tn extends(Ve(Kt)){constructor(e={}){super(((e=Ke(e)).imageExtension||(e.imageExtension="jpg"),!e.mapID||e.url||e.urls||(e.url=e.tms?`tiles/${e.mapID}/{z}/{x}/{-y}.${e.imageExtension}`:`tiles/${e.mapID}/{z}/{x}/{y}.${e.imageExtension}`),e)),e.mapID&&(this.mapID=e.mapID),qe(this,e),Ge(this)}static async createAsync(e){return new tn(e)}insideCheckXy(e){return!this.envelope||Wt(e,this.envelope)}insideCheckSysCoord(e){return this.insideCheckXy(e)}modulateXyInside(e){if(!this.centroid)return e;const t=(0,Ne.Tu)([e,this.centroid]),n=(0,en.Z)(this.envelope,t);return n.features.length>0&&n.features[0].geometry?n.features[0].geometry.coordinates:e}modulateSysCoordInside(e){return this.modulateXyInside(e)}merc2XyAsync(e){return Promise.resolve(e)}merc2XyAsync_ignoreBackground(e){return this.merc2XyAsync(e)}xy2MercAsync(e){return Promise.resolve(e)}xy2SysCoord(e){return e}sysCoord2Xy(e){return e}viewpoint2MercsAsync(e,t){const n=this.viewpoint2SysCoords(e,t),r=this.sysCoords2Xys(n);return this.xys2MercsAsync(r)}mercs2ViewpointAsync(e){return this.mercs2XysAsync(e).then((e=>{const t=this.xys2SysCoords(e);return this.sysCoords2Viewpoint(t)}))}mercs2SysCoordsAsync_multiLayer(e){return Promise.all(e[0].map((e=>this.merc2SysCoordAsync(e)))).then((t=>[[t,e[1]]]))}defZoom(){return this.mercZoom}}class nn extends tn{constructor(e={}){super(e),this.style="",this.accessToken="",this.style=e.style,this.mapboxMap=e.mapboxMap}static async createAsync(e){return new nn(e)}}function rn(e,t){return e+(Math.random()-.5)*t}function on(e,t){if(e instanceof Array)return e.map((e=>on(e,t)));const n=Math.pow(10,t);return Math.round(e*n)/n}function sn(e){return e*Math.PI/180}var an=n(6253);class cn extends an.Z{constructor(e){super({render:function(e){const t=this.getSource(),n=t.mapboxMap;n.setStyle(t.style);const r=n.getCanvas(),i=e.viewState,o=this.getVisible();r.style.display=o?"block":"none";const s=this.getOpacity();r.style.opacity=s;const a=-180*i.rotation/Math.PI,c=(0,je.bU)(i.center),l=i.zoom-1,u=n.getBearing(),h=n.getCenter().toArray(),p=n.getZoom();return a==u&&c[0]==h[0]&&c[1]==h[1]&&l==p||(a!=u&&n.rotateTo(a,{animate:!1}),c[0]==h[0]&&c[1]==h[1]&&l==p||n.jumpTo({center:c,zoom:l,animate:!1}),n._frame&&(n._frame.cancel(),n._frame=null),n._render()),r},source:e.source})}}var ln="assets/images/9ac6d81f417d6a5626b7c8d5a087c32b.png";const un=new zt.ZP({image:new qt.Z({anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"assets/images/6e1f2f2f6fed3c5cddeb925e7ae75aba.png"})}),hn=new zt.ZP({image:new qt.Z({anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"assets/images/6c5dba7f7d76e74c3a8c7c5b1c3fc544.png"})}),pn=new zt.ZP({image:new qt.Z({anchor:[.5,.5],anchorXUnits:"fraction",anchorYUnits:"fraction",src:"assets/images/0beac2cb41dfab43ddfd9df80b32b85d.png"})}),dn=new zt.ZP({fill:new Gt.Z({color:[128,128,256,.2]}),stroke:new Xt.Z({color:[128,128,256,1],width:3})}),fn=new zt.ZP({image:new qt.Z({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:ln})});class gn extends We.Z{constructor(e){e=Ke(e||{});const t=new bt.Z({source:new Rt.Z({wrapX:!1})});t.set("name","gps");const n=new bt.Z({source:new Rt.Z({wrapX:!1})});n.set("name","marker");const r=new bt.Z({source:new Rt.Z({wrapX:!1})});r.set("name","feature");const i=new bt.Z({source:new Rt.Z({wrapX:!1})});i.set("name","envelope");const o=gn.spawnLayer(null,e.source,e.target),s=new wt.Z;s.set("name","overlay");const a={controls:e.controls?e.controls:[],layers:[o,s,i,r,t,n],target:e.div,view:new vt.ZP({center:e.defaultCenter||[0,0],zoom:e.defaultZoom||2,rotation:e.defaultRotation||0,multiWorld:!0})};e.interactions&&(a.interactions=e.interactions),super(a),this._overlay_group=s,this.fakeGps=e.fakeGps,this.fakeRadius=e.fakeRadius,this.homePosition=e.homePosition,this.northUp=e.northUp,this.tapDuration=e.tapDuration,this.homeMarginPixels=e.homeMarginPixels,this.tapUIVanish=e.tapUIVanish;const c=this.getView();this.__AvoidFirstMoveStart=!0;const l=()=>{this.__AvoidFirstMoveStart||this.dispatchEvent("movestart"),this.__AvoidFirstMoveStart=!1,c.un("propertychange",l)};c.on("propertychange",l),this.on("moveend",(()=>{c.on("propertychange",l)}))}static spawnLayer(e,t,n){return t instanceof nn||!(e instanceof Tt)?(e=t instanceof nn?new cn({style:t.style,accessToken:t.accessToken,container:n,source:t}):new Tt({source:t})).set("name","base"):e.setSource(t),e}getLayer(e="base"){const t=n=>{const r=n.getArray().map((n=>n.get("name")==e?n:n.getLayers?t(n.getLayers()):void 0)).filter((e=>e));if(0!=r.length)return r[0]};return t(this.getLayers())}getSource(e="base"){const t=this.getLayer(e);if(t)return t.getSource()}setFeature(e,t,n){const r=this.getSource(n),i=new Qe.Z(e);return t&&i.setStyle(t),r.addFeature(i),i}removeFeature(e,t){this.getSource(t).removeFeature(e)}resetFeature(e){this.getSource(e).clear()}setGPSPosition(e,t=void 0){const n="sub"==t?pn:"hide"==t?hn:un;"sub"!=t&&this.resetFeature("gps"),e&&(this.setFeature({geometry:new Zt.Z(e.xy)},n,"gps"),t||this.setFeature({geometry:new Vt(e.xy,e.rad)},dn,"gps"))}setMarker(e,t,n,r){return r||(r="marker"),t.geometry=new Zt.Z(e),n?"string"==typeof n?n=new zt.ZP({image:new qt.Z({anchor:[.5,1],anchorXUnits:"fraction",anchorYUnits:"fraction",src:n})}):n instanceof zt.ZP||(n=new zt.ZP({image:new qt.Z(n)})):n=fn,this.setFeature(t,n,r)}resetMarker(e){e||(e="marker"),this.resetFeature(e)}setLine(e,t,n){return this.setVector(e,"Line",t?{stroke:t}:null,n)}setVector(e,t="Line",n,r){r||(r="feature");const i={};null!=n.stroke&&(i.stroke=new Xt.Z(n.stroke)),null!=n.fill&&(i.fill=new Gt.Z(n.fill));const o=new zt.ZP(i),s="Line"===t?new $t.Z(e):new tt.ZP(e);return this.setFeature({geometry:s,name:t},o,r)}resetLine(e){this.resetVector(e)}resetVector(e){e||(e="feature"),this.resetFeature(e)}setEnvelope(e,t,n){return n||(n="envelope"),this.setLine(e,t,n)}removeEnvelope(e,t){t||(t="envelope"),this.removeFeature(e,t)}resetEnvelope(e){e||(e="envelope"),this.resetFeature(e)}setFillEnvelope(e,t,n,r){let i;if(r||(r="envelope"),null!=t||null!=n){const e={};null!=t&&(e.stroke=new Xt.Z(t)),null!=n&&(e.fill=new Gt.Z(n)),i=new zt.ZP(e)}return this.setFeature({geometry:new tt.ZP([e])},i,r)}exchangeSource(e=void 0){const t=this.getLayers(),n=t.item(0),r=gn.spawnLayer(n,e,this.getTarget());r!=n&&t.setAt(0,r),e&&e.setMap(this)}setLayer(e=void 0){const t=this.getLayer("overlay").getLayers();if(t.clear(),e){const n=new Tt({source:e});t.push(n)}}setTransparency(e){const t=(100-e)/100;this.getSource()instanceof tn?(this.getLayers().item(0).setOpacity(1),this.getLayers().item(1).setOpacity(t)):this.getLayers().item(0).setOpacity(t)}setGPSMarker(e,t){this.getLayers().item(0).getSource().setGPSMarker(e,t)}handleGPS(e,t){if(e)if(this.dispatchEvent("gps_request"),this._first_gps_request=!0,this.geolocation)this.geolocation.setTracking(!0);else{const e=this.geolocation=new mt({tracking:!0});e.on("change",(t=>{const n=this.getLayer("overlay").getLayers().item(0),r=n?n.getSource():this.getLayers().item(0).getSource();let i=e.getPosition(),o=e.getAccuracy();var s,a;this.fakeGps&&(s=this.homePosition,a=i,6378.14*Math.acos(Math.cos(sn(s[1]))*Math.cos(sn(a[1]))*Math.cos(sn(a[0])-sn(s[0]))+Math.sin(sn(s[1]))*Math.sin(sn(a[1])))>this.fakeGps)&&(i=[rn(this.homePosition[0],.001),rn(this.homePosition[1],.001)],o=rn(15,10));let c={lnglat:i,acc:o};r.setGPSMarkerAsync(c,!this._first_gps_request).then((e=>{e||(c={error:"gps_out"}),this._first_gps_request=!1,this.dispatchEvent(new yt.Z("gps_result",this,c))}))})),e.on("error",(e=>{const t=this.getLayers().item(0).getSource();let n=null;if(this.fakeGps){const e=[rn(this.homePosition[0],.001),rn(this.homePosition[1],.001)],t=rn(15,10);n={lnglat:e,acc:t}}t.setGPSMarkerAsync(n,!this._first_gps_request).then((e=>{e||(n={error:"gps_out"}),this._first_gps_request=!1,this.dispatchEvent(new yt.Z("gps_result",this,n))}))}))}else{this.geolocation&&this.geolocation.setTracking(!1);this.getLayers().item(0).getSource().setGPSMarker(),t||this.dispatchEvent(new yt.Z("gps_result",this,{error:"gps_off"}))}}}var mn=n(3358),yn=n(4810),vn=n(2581);class bn extends yn.Z{constructor(e){super(e=e||{}),this.condition_=e.condition?e.condition:vn.vY,this.lastAngle_=void 0,this.lastMagnitude_=void 0,this.lastScaleDelta_=0,this.duration_=void 0!==e.duration?e.duration:400}handleDragEvent(e){if(!(0,vn.QL)(e))return;const t=e.map,n=t.getSize(),r=e.pixel,i=r[0]-n[0]/2,o=n[1]/2-r[1],s=Math.atan2(o,i),a=Math.sqrt(i*i+o*o),c=t.getView();if(void 0!==this.lastAngle_){const e=this.lastAngle_-s;c.adjustRotationInternal(e)}this.lastAngle_=s,void 0!==this.lastMagnitude_&&c.adjustResolutionInternal(this.lastMagnitude_/a),void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/a),this.lastMagnitude_=a}handleUpEvent(e){if(!(0,vn.QL)(e))return!0;const t=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return t.endInteraction(this.duration_,n),this.lastScaleDelta_=0,!1}handleDownEvent(e){return!!(0,vn.QL)(e)&&(!!this.condition_(e)&&(e.map.getView().beginInteraction(),this.lastAngle_=void 0,this.lastMagnitude_=void 0,!0))}}var wn=bn,kn=n(9362);for(let e=0;e<9;e++){!function(e,t){const n=new je.kv({code:e,extent:[0,0,t,t],units:"m"});(0,je.Sx)(n),(0,je.zY)("EPSG:3857",n,(e=>[(e[0]+Ee)*t/(2*Ee),(-e[1]+Ee)*t/(2*Ee)]),(e=>[e[0]*(2*Ee)/t-Ee,-1*(e[1]*(2*Ee)/t-Ee)]))}(`ZOOM:${e}`,256*Math.pow(2,e))}class xn extends(Ve(Ht.Z)){constructor(e={}){super(e=(()=>{(e=Ke(e)).wrapX=!1,e.imageExtension||(e.imageExtension="jpg"),!e.mapID||e.url||e.urls||(e.url=`tiles/${e.mapID}/{z}/{x}/{y}.${e.imageExtension}`);const t=Math.log2(e.width/Ce),n=Math.log2(e.height/Ce);return e.maxZoom=Math.ceil(Math.max(t,n)),e.tileUrlFunction=e.tileUrlFunction||function(e){const t=e[0],n=e[1],r=e[2];return n*Ce*Math.pow(2,this.maxZoom-t)>=this.width||r*Ce*Math.pow(2,this.maxZoom-t)>=this.height||n<0||r<0?Ie:this._tileUrlFunction(e)},e})()),e.mapID&&(this.mapID=e.mapID),e.urls?this._tileUrlFunction=(0,kn.uR)(e.urls):e.url&&(this._tileUrlFunction=(0,kn.uR)((0,kn.Gk)(e.url))),this.width=e.width,this.height=e.height,this.maxZoom=e.maxZoom,this._maxxy=Math.pow(2,this.maxZoom)*Ce,qe(this,e),Ge(this)}insideCheckXy(e){return!(e[0]<0||e[0]>this.width||e[1]<0||e[1]>this.height)}insideCheckSysCoord(e){return this.insideCheckXy(this.sysCoord2Xy(e))}modulateXyInside(e){const t=e[0]/(this.width/2)-1,n=e[1]/(this.height/2)-1,r=Math.max(Math.abs(t),Math.abs(n));return[(t/r+1)*this.width/2,(n/r+1)*this.height/2]}modulateSysCoordInside(e){const t=this.sysCoord2Xy(e),n=this.modulateXyInside(t);return this.xy2SysCoord(n)}xy2SysCoord(e){return[e[0]*(2*Ee)/this._maxxy-Ee,-1*(e[1]*(2*Ee)/this._maxxy-Ee)]}sysCoord2Xy(e){return[(e[0]+Ee)*this._maxxy/(2*Ee),(-e[1]+Ee)*this._maxxy/(2*Ee)]}defZoom(e){const t=e[0],n=e[1],r=Math.log2((t-10)/this.width),i=Math.log2((n-10)/this.height);let o;return o=i>r?i:r,this.maxZoom+o}}class Sn extends tn{constructor(e={}){super(Object.assign(e,{opaque:!1}))}static async createAsync(e){return new Sn(e)}}const On="https://weiwudi.example.com/api/";let Mn,Pn;!function(){if("function"==typeof window.CustomEvent)return!1;function e(e,t){t=t||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n}e.prototype=window.Event.prototype,window.CustomEvent=e}();class _n{constructor(){this.listeners={}}addEventListener(e,t){e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)}removeEventListener(e,t){if(!(e in this.listeners))return;const n=this.listeners[e];for(let e=0,r=n.length;e<r;e++)if(n[e]===t)return void n.splice(e,1)}dispatchEvent(e){if(!(e.type in this.listeners))return!0;const t=this.listeners[e.type].slice();for(let n=0,r=t.length;n<r;n++)t[n].call(this,e);return!e.defaultPrevented}}class An extends _n{static async registerSW(e,t){if(!("serviceWorker"in navigator))throw"Error: Service worker is not supported";try{const n=await navigator.serviceWorker.register(e,t),r=n.installing,i=n.waiting;return r&&("activated"!==r.state||i||window.location.reload(),r.addEventListener("statechange",(e=>{"activated"!==r.state||i||window.location.reload()}))),n.onupdatefound=()=>{n.update()},await An.swCheck(),n}catch(e){throw`Error: Service worker registration failed with ${e}`}}static async swCheck(){return void 0!==Pn?Pn:(void 0===Mn&&(Mn=new Promise((async(e,t)=>{try{Pn=await fetch(`${On}ping`),Pn=!!Pn}catch(e){Pn=!1}e(Pn)}))),Mn)}static async registerMap(e,t){if(!await An.swCheck())throw"Weiwudi service worker is not implemented.";let n;try{const r=["type","url","width","height","tileSize","minZoom","maxZoom","maxLng","maxLat","minLng","minLat"].reduce(((e,n)=>(void 0!==t[n]&&(t[n]instanceof Array?t[n].map((t=>{e.append(n,t)})):e.append(n,t[n])),e)),new URLSearchParams);r.append("mapID",e);const i=new URL(`${On}add`);i.search=r;const o=await fetch(i.href);n=await o.text()}catch(e){throw e}if(n.match(/^Error: /))throw n;return new An(e,JSON.parse(n))}static async retrieveMap(e){if(!await An.swCheck())throw"Weiwudi service worker is not implemented.";let t;try{const n=await fetch(`${On}info?mapID=${e}`);t=await n.text()}catch(e){throw e}if(t.match(/^Error: /))throw t;return console.log(t),new An(e,JSON.parse(t))}static async removeMap(e){if(!await An.swCheck())throw"Weiwudi service worker is not implemented.";let t;try{const n=await fetch(`${On}delete?mapID=${e}`);t=await n.text()}catch(e){throw e}if(t.match(/^Error: /))throw t}constructor(e,t){if(super(),!e)throw"MapID is necessary.";this.mapID=e,t&&Object.assign(this,t),this.url=`${On}cache/${e}/{z}/{x}/{y}`,this.listener=t=>{t.data.mapID===e&&this.dispatchEvent(new CustomEvent(t.data.type,{detail:t.data}))},navigator.serviceWorker.addEventListener("message",this.listener)}release(){navigator.serviceWorker.removeEventListener("message",this.listener),delete this.mapID}checkAspect(){if(!this.mapID)throw"This instance is already released."}async stats(){let e;this.checkAspect();try{const t=await fetch(`${On}stats?mapID=${this.mapID}`);e=await t.text()}catch(e){throw e}if("string"==typeof e&&e.match(/^Error: /))throw e;return JSON.parse(e)}async clean(){let e;this.checkAspect();try{const t=await fetch(`${On}clean?mapID=${this.mapID}`);e=await t.text()}catch(e){throw e}if(e.match(/^Error: /))throw e}async fetchAll(){let e;this.checkAspect();try{const t=await fetch(`${On}fetchAll?mapID=${this.mapID}`);e=await t.text()}catch(e){throw e}if(e.match(/^Error: /))throw e}async remove(){this.checkAspect(),await An.removeMap(this.mapID),this.release()}async cancel(){let e;this.checkAspect();try{const t=await fetch(`${On}cancel?mapID=${this.mapID}`);e=await t.text()}catch(e){throw e}if(e.match(/^Error: /))throw e}}var jn=n(9425);function En(e,t,n){const r="string"==typeof e?e:e.getCode(),i="string"==typeof t?t:t.getCode();let o=(0,je.Ck)(e,t);if(o==je.gD&&r!=i){const n=(0,je.Ck)(e,"EPSG:3857"),s=(0,je.Ck)("EPSG:3857",t);if(n==je.gD&&"EPSG:3857"!=r)throw"Transform of Source projection is not defined.";if(s==je.gD&&"EPSG:3857"!=i)throw"Transform of Distination projection is not defined.";o=function(n){return(0,je.vs)((0,je.vs)(n,e,"EPSG:3857"),"EPSG:3857",t)};const a=function(n){return(0,je.vs)((0,je.vs)(n,t,"EPSG:3857"),"EPSG:3857",e)};(0,je.zY)(e,t,o,a)}if(n)return o(n)}var Ln=n(4583);const In=["title","attr","officialTitle","dataAttr","author","createdAt","era","license","dataLicense","contributor","mapper","reference","description","url","lang","imageExtension","homePosition","mercZoom"];async function Cn(e,t,n){const r=n?e:{},i=[];if(In.forEach((t=>{r[t]=e[t]})),e.imageExtention&&(r.imageExtension=e.imageExtention),e.compiled){const n={};e.compiled.wh||(n.wh=[e.width,e.height]),e.compiled.strictMode||(n.strictMode=e.strictMode),e.compiled.vertexMode||(n.vertexMode=e.vertexMode),e.compiled.yaxisMode||(n.yaxisMode=e.yaxisMode);let o=new Ln.Z(n);o.setCompiled(e.compiled),t&&(o=o.getCompiled()),r.strictMode=o.strictMode,r.vertexMode=o.vertexMode,r.yaxisMode=o.yaxisMode,r.width=o.wh[0],r.height=o.wh[1],r.gcps=o.points,r.edges=o.edges,i.push(o)}else{r.strictMode=e.strictMode,r.vertexMode=e.vertexMode,r.yaxisMode=e.yaxisMode,r.width=e.width,r.height=e.height,r.gcps=e.gcps,r.edges=e.edges;let n=await Dn(e.strictMode,e.vertexMode,e.yaxisMode,e.gcps,e.edges,[e.width,e.height]);t&&"string"!=typeof n&&(n=n.getCompiled()),i.push(n)}if(e.sub_maps){const n=[];for(let r=0;r<e.sub_maps.length;r++){const o=e.sub_maps[r],s={};if(s.importance=o.importance,s.priority=o.priority,o.compiled){const n={};o.compiled.strictMode||(n.strictMode=e.strictMode),o.compiled.vertexMode||(n.vertexMode=e.vertexMode),o.compiled.yaxisMode||(n.yaxisMode=e.yaxisMode);let r=new Ln.Z(n);r.setCompiled(o.compiled),t&&(r=r.getCompiled()),s.bounds=r.bounds,s.gcps=r.points,s.edges=r.edges,i.push(r)}else{s.bounds=o.bounds,s.gcps=o.gcps,s.edges=o.edges;let n=await Dn(e.strictMode,e.vertexMode,e.yaxisMode,o.gcps,o.edges,void 0,o.bounds);t&&"string"!=typeof n&&(n=n.getCompiled()),i.push(n)}n.push(s)}r.sub_maps=n}return[r,i]}async function Dn(e,t,n,r=[],i=[],o,s){if(r.length<3)return"tooLessGcps";const a=new Ln.Z({yaxisMode:n});if(o)a.setWh(o);else{if(!s)throw"Both wh and bounds are missing";a.setBounds(s)}a.setStrictMode(e),a.setVertexMode(t),a.setPoints(r),a.setEdges(i);try{return await a.updateTinAsync(),a}catch(e){if(console.log(e),"SOME POINTS OUTSIDE"==e)return"pointsOutside";if(0==e.indexOf("TOO LINEAR"))return"tooLinear";if(e.indexOf("Vertex indices of edge")>-1||e.indexOf("is degenerate!")>-1||e.indexOf("already exists or intersects with an existing edge!")>-1)return"edgeError";throw e}}class Tn extends xn{constructor(e={}){super(e),this.tins=[]}static async createAsync(e){const t=await async function(e){return Cn(e,!1,!0)}(e);e=t[0];const n=new Tn(e);n.tins=t[1];const r=new jn.Z({code:`Illst:${n.mapID}`,extent:[0,0,n.width,n.height],units:"m"});return(0,je.Sx)(r),(0,je.zY)(r,"EPSG:3857",(e=>n.tins[0].transform(e,!1)),(e=>n.tins[0].transform(e,!0))),En("EPSG:4326",r),e.sub_maps&&e.sub_maps.map(((e,t)=>{const r=t+1,i=`Illst:${n.mapID}#${r}`,o=n.tins[r],s=new jn.Z({code:i,extent:[o.xy[0],o.xy[1],o.wh[0],o.wh[1]],units:"m"});(0,je.Sx)(s),(0,je.zY)(s,"EPSG:3857",(e=>o.transform(e,!1,!0)),(e=>o.transform(e,!0,!0))),En("EPSG:4326",s);const a=Object.assign([],e.bounds);a.push(e.bounds[0]);const c=a.map((e=>o.transform(e,!1))),l=(0,Ne.yu)([a]),u=(0,Ne.yu)([c]);o.xyBounds=l,o.mercBounds=u})),n}xy2MercAsync_specifyLayer(e,t){const n=`Illst:${this.mapID}${t?`#${t}`:""}`;return new Promise(((t,r)=>{t(En(n,"EPSG:3857",e))}))}merc2XyAsync_specifyLayer(e,t){const n=`Illst:${this.mapID}${t?`#${t}`:""}`;return new Promise(((t,r)=>{t(En("EPSG:3857",n,e))}))}xy2MercAsync_returnLayer(e){return new Promise(((t,n)=>{const r=this.tins.map(((e,t)=>[t,e])).sort(((e,t)=>e[1].priority<t[1].priority?1:-1));for(let i=0;i<r.length;i++){const o=r[i][0],s=r[i][1];if(0==o||Wt(e,s.xyBounds)){this.xy2MercAsync_specifyLayer(e,o).then((e=>{t([o,e])})).catch((e=>{n(e)}));break}}}))}merc2XyAsync_returnLayer(e){return Promise.all(this.tins.map(((t,n)=>new Promise(((r,i)=>{this.merc2XyAsync_specifyLayer(e,n).then((e=>{0===n||Wt(e,t.xyBounds)?r([t,n,e]):r([t,n])})).catch((e=>{i(e)}))}))))).then((e=>e.sort(((e,t)=>e[0].priority<t[0].priority?1:-1)).reduce(((e,t,n,r)=>{const i=t[0],o=t[1],s=t[2];if(!s)return e;for(let t=0;t<n;t++){const n=r[t][0];if(0===r[t][1]||Wt(s,n.xyBounds)){if(e.length){const t=!e[0],n=t?e[1][2]:e[0][2];return!t||i.importance<n.importance?e:[void 0,[o,s,i]]}return[void 0,[o,s,i]]}}return e.length&&e[0]?(e.push([o,s,i]),e.sort(((e,t)=>e[2].importance<t[2].importance?1:-1)).filter(((e,t)=>t<2))):[[o,s,i]]}),[]).map((e=>{if(e)return[e[0],e[1]]}))))}setupMapParameter(e){const t=[this.width/2,this.height/2];this.xy2MercAsync_returnLayer(t).then((n=>{const r=n[0],i=n[1],o=[[t[0]-150,t[1]],[t[0]+150,t[1]],[t[0],t[1]-150],[t[0],t[1]+150]],s=[[0,0],[this.width,0],[this.width,this.height],[0,this.height]],a=[];for(let e=0;e<9;e++){const t=e<4?this.xy2MercAsync_specifyLayer(o[e],r):4==e?Promise.resolve(i):this.xy2MercAsync_specifyLayer(s[e-5],0);a.push(t)}Promise.all(a).then((t=>{const n=(Math.sqrt(Math.pow(t[0][0]-t[1][0],2)+Math.pow(t[0][1]-t[1][1],2))+Math.sqrt(Math.pow(t[2][0]-t[3][0],2)+Math.pow(t[2][1]-t[3][1],2)))/2;this.mercZoom||(this.mercZoom=Math.log(2*Ee*300/256/n)/Math.log(2)-3),this.homePosition||(this.homePosition=(0,je.bU)(t[4])),this.envelope=(0,Ne.yu)([[t[5],t[6],t[7],t[8],t[5]]]),e(this)})).catch((e=>{throw e}))})).catch((e=>{throw e}))}mercs2SysCoordsAsync_multiLayer(e){return this.merc2XyAsync_returnLayer(e[0][0]).then((t=>{let n=!1;return Promise.all(t.map(((t,r)=>{if(!t)return void(n=!0);const i=t[0],o=t[1];return 0===r||n?Promise.all(e[0].map(((e,t)=>0===t?Promise.resolve(o):this.merc2XyAsync_specifyLayer(e,i)))):Promise.resolve([o])})))})).then((t=>t.map((t=>{if(t)return[t.map((e=>this.xy2SysCoord(e))),e[1]]}))))}merc2XyAsync_base(e,t){return this.merc2XyAsync_returnLayer(e).then((e=>{if(!t||e[0])return e[0]?e[0][1]:e[1][1]}))}merc2XyAsync_ignoreBackground(e){return this.merc2XyAsync_base(e,!0)}merc2XyAsync(e){return this.merc2XyAsync_base(e,!1)}xy2MercAsync(e){return this.xy2MercAsync_returnLayer(e).then((e=>e[1]))}viewpoint2MercsAsync(e,t){const n=this.viewpoint2SysCoords(e,t),r=this.sysCoords2Xys(n);return this.xy2MercAsync_returnLayer(r[0][0]).then((e=>{const n=e[0],i=e[1],o=r[0].map(((e,t)=>0===t?Promise.resolve(i):this.xy2MercAsync_specifyLayer(e,n)));return Promise.all(o).then((e=>[e,t]))}))}mercs2ViewpointAsync(e){return this.merc2XyAsync_returnLayer(e[0][0]).then((t=>{const n=t[0]||t[1],r=n[0],i=n[1];return Promise.all(e[0].map(((e,t)=>0===t?i:this.merc2XyAsync_specifyLayer(e,r))))})).then((t=>{const n=this.xys2SysCoords([t,e[1]]);return this.sysCoords2Viewpoint(n)}))}}var Rn="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==Rn&&Rn,Zn={searchParams:"URLSearchParams"in Rn,iterable:"Symbol"in Rn&&"iterator"in Symbol,blob:"FileReader"in Rn&&"Blob"in Rn&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in Rn,arrayBuffer:"ArrayBuffer"in Rn};if(Zn.arrayBuffer)var Bn=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],Fn=ArrayBuffer.isView||function(e){return e&&Bn.indexOf(Object.prototype.toString.call(e))>-1};function Nn(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function Un(e){return"string"!=typeof e&&(e=String(e)),e}function Vn(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return Zn.iterable&&(t[Symbol.iterator]=function(){return t}),t}function $n(e){this.map={},e instanceof $n?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function zn(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function qn(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function Gn(e){var t=new FileReader,n=qn(t);return t.readAsArrayBuffer(e),n}function Xn(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function Hn(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:Zn.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:Zn.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:Zn.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():Zn.arrayBuffer&&Zn.blob&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=Xn(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):Zn.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||Fn(e))?this._bodyArrayBuffer=Xn(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):Zn.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},Zn.blob&&(this.blob=function(){var e=zn(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=zn(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(Gn)}),this.text=function(){var e,t,n,r=zn(this);if(r)return r;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=qn(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),r=0;r<t.length;r++)n[r]=String.fromCharCode(t[r]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},Zn.formData&&(this.formData=function(){return this.text().then(Yn)}),this.json=function(){return this.text().then(JSON.parse)},this}$n.prototype.append=function(e,t){e=Nn(e),t=Un(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},$n.prototype.delete=function(e){delete this.map[Nn(e)]},$n.prototype.get=function(e){return e=Nn(e),this.has(e)?this.map[e]:null},$n.prototype.has=function(e){return this.map.hasOwnProperty(Nn(e))},$n.prototype.set=function(e,t){this.map[Nn(e)]=Un(t)},$n.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},$n.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),Vn(e)},$n.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),Vn(e)},$n.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),Vn(e)},Zn.iterable&&($n.prototype[Symbol.iterator]=$n.prototype.entries);var Jn=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Kn(e,t){if(!(this instanceof Kn))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var n,r,i=(t=t||{}).body;if(e instanceof Kn){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new $n(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,i||null==e._bodyInit||(i=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new $n(t.headers)),this.method=(n=t.method||this.method||"GET",r=n.toUpperCase(),Jn.indexOf(r)>-1?r:n),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(i),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var o=/([?&])_=[^&]*/;if(o.test(this.url))this.url=this.url.replace(o,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function Yn(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),r=n.shift().replace(/\+/g," "),i=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(r),decodeURIComponent(i))}})),t}function Wn(e,t){if(!(this instanceof Wn))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new $n(t.headers),this.url=t.url||"",this._initBody(e)}Kn.prototype.clone=function(){return new Kn(this,{body:this._bodyInit})},Hn.call(Kn.prototype),Hn.call(Wn.prototype),Wn.prototype.clone=function(){return new Wn(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new $n(this.headers),url:this.url})},Wn.error=function(){var e=new Wn(null,{status:0,statusText:""});return e.type="error",e};var Qn=[301,302,303,307,308];Wn.redirect=function(e,t){if(-1===Qn.indexOf(t))throw new RangeError("Invalid status code");return new Wn(null,{status:t,headers:{location:e}})};var er=Rn.DOMException;try{new er}catch(e){(er=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack}).prototype=Object.create(Error.prototype),er.prototype.constructor=er}function tr(e,t){return new Promise((function(n,r){var i=new Kn(e,t);if(i.signal&&i.signal.aborted)return r(new er("Aborted","AbortError"));var o=new XMLHttpRequest;function s(){o.abort()}o.onload=function(){var e,t,r={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new $n,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var n=e.split(":"),r=n.shift().trim();if(r){var i=n.join(":").trim();t.append(r,i)}})),t)};r.url="responseURL"in o?o.responseURL:r.headers.get("X-Request-URL");var i="response"in o?o.response:o.responseText;setTimeout((function(){n(new Wn(i,r))}),0)},o.onerror=function(){setTimeout((function(){r(new TypeError("Network request failed"))}),0)},o.ontimeout=function(){setTimeout((function(){r(new TypeError("Network request failed"))}),0)},o.onabort=function(){setTimeout((function(){r(new er("Aborted","AbortError"))}),0)},o.open(i.method,function(e){try{return""===e&&Rn.location.href?Rn.location.href:e}catch(t){return e}}(i.url),!0),"include"===i.credentials?o.withCredentials=!0:"omit"===i.credentials&&(o.withCredentials=!1),"responseType"in o&&(Zn.blob?o.responseType="blob":Zn.arrayBuffer&&i.headers.get("Content-Type")&&-1!==i.headers.get("Content-Type").indexOf("application/octet-stream")&&(o.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof $n?i.headers.forEach((function(e,t){o.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){o.setRequestHeader(e,Un(t.headers[e]))})),i.signal&&(i.signal.addEventListener("abort",s),o.onreadystatechange=function(){4===o.readyState&&i.signal.removeEventListener("abort",s)}),o.send(void 0===i._bodyInit?null:i._bodyInit)}))}tr.polyfill=!0,Rn.fetch||(Rn.fetch=tr,Rn.Headers=$n,Rn.Request=Kn,Rn.Response=Wn);const nr={osm:{mapID:"osm",title:{ja:"オープンストリートマップ",en:"OpenStreetMap"},label:{ja:"OSM(現在)",en:"OSM(Now)"},attr:"©︎ OpenStreetMap contributors",maptype:"base",thumbnail:"assets/images/6345ee67d554fbfbf484ba4035ad19d9.jpg",urls:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png","https://b.tile.openstreetmap.org/{z}/{x}/{y}.png","https://c.tile.openstreetmap.org/{z}/{x}/{y}.png"]},gsi:{mapID:"gsi",title:{ja:"地理院地図",en:"Geospatial Information Authority of Japan Map"},label:{ja:"地理院地図",en:"GSI Map"},attr:{ja:"国土地理院",en:"The Geospatial Information Authority of Japan"},maptype:"base",url:"https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",maxZoom:18,thumbnail:"assets/images/b9ae27f0a01228380dff76a33b605707.jpg"},gsi_ortho:{mapID:"gsi_ortho",title:{ja:"地理院地図オルソ航空写真",en:"Geospatial Information Authority of Japan Ortho aerial photo"},label:{ja:"地理院オルソ",en:"GSI Ortho"},attr:{ja:"国土地理院",en:"The Geospatial Information Authority of Japan"},maptype:"base",url:"https://cyberjapandata.gsi.go.jp/xyz/ort/{z}/{x}/{y}.jpg",maxZoom:18,thumbnail:"assets/images/41b2cf0fa604d3f196ca52337d238219.jpg"}};async function rr(e,t){if("string"==typeof e&&(e=nr[e]),(e=Ke(Object.assign(e,t))).label=e.label||e.year,"base"===e.maptype||"overlay"===e.maptype||"mapbox"===e.maptype){const t="base"===e.maptype?tn:"overlay"===e.maptype?Sn:nn;t instanceof Sn?(e.homePosition||(e.homePosition=e.homePos),e.mercZoom||(e.mercZoom=e.defZoom)):(e.homePosition=e.homePos,e.mercZoom=e.defZoom),delete e.homePos,delete e.defZoom,e.zoomRestriction&&(e.maxZoom=e.maxZoom||e.mercMaxZoom,e.minZoom=e.minZoom||e.mercMinZoom),e.zoomRestriction=e.mercMaxZoom=e.mercMinZoom=void 0,e.translator&&(e.url=e.translator(e.url)),e.imageExtension||(e.imageExtension="jpg"),!e.mapID||e.url||e.urls||(e.url=e.tms?`tiles/${e.mapID}/{z}/{x}/{-y}.${e.imageExtension}`:`tiles/${e.mapID}/{z}/{x}/{y}.${e.imageExtension}`),e.weiwudi=await ir(e),e.weiwudi&&(e.url=e.weiwudi.url,delete e.urls);const n=await t.createAsync(e);return await n.initialWait,n}return e.noload?(e.mercMaxZoom=e.mercMinZoom=void 0,new Tn(e)):new Promise(((t,n)=>{const r=e.settingFile||`maps/${e.mapID}.json`,i=new XMLHttpRequest;i.open("GET",r,!0),i.responseType="json",i.onload=async function(r){if(200===this.status||0===this.status)try{let r=this.response;if("object"!=typeof r&&(r=JSON.parse(r)),(e=Ke(Object.assign(r,e))).label=e.label||r.year,e.translator&&(e.url=e.translator(e.url)),e.maptype||(e.maptype="maplat"),"base"===e.maptype||"overlay"===e.maptype||"mapbox"===e.maptype){const r="base"===e.maptype?tn:"overlay"===e.maptype?Sn:nn;r instanceof Sn?(e.homePosition||(e.homePosition=e.homePos),e.mercZoom||(e.mercZoom=e.defZoom)):(e.homePosition=e.homePos,e.mercZoom=e.defZoom),delete e.homePos,delete e.defZoom,e.zoomRestriction&&(e.maxZoom=e.maxZoom||e.mercMaxZoom,e.minZoom=e.minZoom||e.mercMinZoom),e.zoomRestriction=e.mercMaxZoom=e.mercMinZoom=void 0;try{e.imageExtension||(e.imageExtension="jpg"),!e.mapID||e.url||e.urls||(e.url=e.tms?`tiles/${e.mapID}/{z}/{x}/{-y}.${e.imageExtension}`:`tiles/${e.mapID}/{z}/{x}/{y}.${e.imageExtension}`),e.weiwudi=await ir(e),e.weiwudi&&(e.url=e.weiwudi.url,delete e.urls);const n=await r.createAsync(e);try{await n.initialWait,t(n)}catch(e){t(n)}}catch(e){n(e)}return}try{delete e.homePos,delete e.defZoom,e.imageExtension||(e.imageExtension="jpg"),!e.mapID||e.url||e.urls||(e.url=`tiles/${e.mapID}/{z}/{x}/{y}.${e.imageExtension}`),e.width=e.width||e.compiled.wh[0],e.height=e.height||e.compiled.wh[1],e.weiwudi=await ir(e),e.weiwudi&&(e.url=e.weiwudi.url,delete e.urls);const n=await Tn.createAsync(e);try{await n.initialWait,n.setupMapParameter(t)}catch(e){n.setupMapParameter(t)}}catch(e){n(e)}}catch(e){n(e)}else n("Fail to load map json")},i.send()}))}async function ir(e){const t={};if("mapbox"===e.maptype||!e.enableCache)return;"base"===e.maptype||"overlay"===e.maptype?t.type="wmts":t.type="xyz",t.url=e.urls?e.urls:e.url,t.width=e.width,t.height=e.height,t.maxZoom=e.maxZoom,t.minZoom=e.minZoom;const n=e.envelopeLngLats;if(n){const e=n.reduce(((e,t)=>(e[0]=e[0]>t[0]?t[0]:e[0],e[1]=e[1]<t[0]?t[0]:e[1],e[2]=e[2]>t[1]?t[1]:e[2],e[3]=e[3]<t[1]?t[1]:e[3],e)),[1/0,-1/0,1/0,-1/0]);["minLng","maxLng","minLat","maxLat"].map(((n,r)=>{t[n]=e[r]}))}let r;try{r=await An.registerMap(e.mapID,t)}catch(e){}return r}var or={},sr=n(6169),ar=n.n(sr);function cr(e,...t){const n=Ke(Object.assign({},e));if(n.icon)return n;const r=t.reduce(((e,t)=>{if(e)return e;const r=t.iconTemplate||t.iconTemplate;return r?JSON.parse(ar()(r)(n)):t.icon?{icon:t.icon,selectedIcon:t.selectedIcon||t.selectedIcon}:void 0}),void 0);return r&&(n.icon=r.icon,n.selectedIcon=r.selectedIcon),n}function lr(e,...t){return(e=Ke(e)).html?e:t.reduce(((t,n)=>{if(t)return t;const r=n.poiTemplate;return r?(e.html=ar()(r)(e),e.poiStyle=e.poiStyle||n.poiStyle,e):void 0}),void 0)||e}class ur extends Ye.Z{constructor(e){super(),this.translateUI=!1,this.noRotate=!1,this.initialRestore={},this.mapDiv="map_div",this.restoreSession=!1,this.stateBuffer={},this.overlay=!0,this.appLang="ja",this.timer=void 0,this.startFrom="",this.vectors=[],this.__backMapMoving=!1,this.__init=!0,this.__redrawMarkerBlock=!1,this.__redrawMarkerThrottle=[],e=Ke(e),this.appid=e.appid||"sample",e.mapboxgl&&(this.mapboxgl=e.mapboxgl,e.mapboxToken&&(this.mapboxgl.accessToken=e.mapboxToken)),this.mapDiv=e.div||"map_div",this.mapDivDocument=document.querySelector(`#${this.mapDiv}`),this.mapDivDocument.classList.add("maplat"),this.logger=new Ae(e.debug?_e.ALL:_e.INFO),this.enableCache=e.enableCache||!1,this.icon=e.icon,this.selectedIcon=e.selectedIcon,this.translateUI=e.translateUI;const t=e.setting;if(this.lang=e.lang,this.lang||(this.lang=Me()),"zh-hk"!=this.lang.toLowerCase()&&"zh-hant"!=this.lang.toLowerCase()||(this.lang="zh-TW"),e.restore)e.restoreSession&&(this.restoreSession=!0),this.initialRestore=e.restore;else if(e.restoreSession){this.restoreSession=!0;const e=parseInt(localStorage.getItem("epoch")||"0"),t=Math.floor((new Date).getTime()/1e3);e&&t-e<3600&&(this.initialRestore.mapID=localStorage.getItem("mapID")||localStorage.getItem("sourceID")||void 0,this.initialRestore.backgroundID=localStorage.getItem("backgroundID")||localStorage.getItem("backID")||void 0,this.initialRestore.position={x:parseFloat(localStorage.getItem("x")||"0"),y:parseFloat(localStorage.getItem("y")||"0"),zoom:parseFloat(localStorage.getItem("zoom")||"0"),rotation:parseFloat(localStorage.getItem("rotation")||"0")},this.initialRestore.transparency=parseFloat(localStorage.getItem("transparency")||"0"),this.initialRestore.hideMarker=parseInt(localStorage.getItem("hideMarker")||"0"),this.initialRestore.hideLayer=localStorage.getItem("hideLayer")||void 0)}const n=Xe('<img id="center_circle" class="prevent-default" alt=""\n            style="position:absolute;top:50%;left:50%;margin-top:-10px;\n            margin-left:-10px;" src="assets/images/7df82bae917b68159f84998182f2fdc6.png">');for(let e=n.length-1;e>=0;e--)this.mapDivDocument.insertBefore(n[e],this.mapDivDocument.firstChild);const r=this.mapDivDocument.querySelectorAll(".prevent-default");for(let e=0;e<r.length;e++){r[e].addEventListener("touchstart",(e=>{e.preventDefault()}))}this.overlay=!("overlay"in e)||e.overlay,this.overlay&&this.mapDivDocument.classList.add("with-opacity"),this.waitReady=this.settingLoader(t).then((t=>this.handleSetting(t,e)))}async settingLoader(e){return e||new Promise(((e,t)=>{const n=new XMLHttpRequest;n.open("GET",`apps/${this.appid}.json`,!0),n.responseType="json",n.onload=function(t){let n=this.response;"object"!=typeof n&&(n=JSON.parse(n)),e(n)},n.send()}))}async i18nLoader(){return new Promise(((e,t)=>{const n=0!=Object.keys(or).length;(this.translateUI&&!n?ge.use(xe):ge).init({lng:this.lang,fallbackLng:["en"],backend:{loadPath:"assets/locales/{{lng}}/{{ns}}.json"},resources:n?or:void 0},((t,n)=>{e([n,ge])}))}))}async sourcesLoader(e){const t=this.appData.sources,n=[],r={homePos:e.homePos,defZoom:e.defZoom,zoomRestriction:e.zoomRestriction,mercMinZoom:e.mercMinZoom,mercMaxZoom:e.mercMaxZoom,enableCache:this.enableCache,translator:e=>this.translate(e)};for(let e=0;e<t.length;e++){const i=t[e];n.push(rr(i,r))}return Promise.all(n)}handleSetting(e,t){return this.appData=Ke(e),!this.lang&&this.appData.lang&&(this.lang=this.appData.lang),this.i18nLoader().then((e=>this.handleI18n(e,t)))}handleI18n(e,t){this.i18n=e[1],this.t=e[0];const n=this.prepareMap(t);return Re(this.appData.pois||[],this).then((e=>this.handlePois(e,n)))}prepareMap(e){e=Ke(e),this.mercBuffer=null;const t=this.appData.homePosition,n=this.appData.defaultZoom,r=this.appData.zoomRestriction,i=this.appData.minZoom,o=this.appData.maxZoom;this.appName=this.appData.appName;const s=!!e.fake&&this.appData.fakeGps,a=!!e.fake&&this.appData.fakeRadius;this.appLang=this.appData.lang||"ja",this.noRotate=e.noRotate||this.appData.noRotate||!1,this.poiTemplate=e.poiTemplate||this.appData.poiTemplate||!1,this.poiStyle=e.poiStyle||this.appData.poiStyle||!1,this.iconTemplate=e.iconTemplate||this.appData.iconTemplate||!1,this.currentPosition=null,this.__init=!0,this.dispatchEvent(new Oe("uiPrepare"));const c=`${this.mapDiv}_front`;let l=Xe(`<div id="${c}" class="map" style="top:0; left:0; right:0; bottom:0; position:absolute;"></div>`)[0];this.mapDivDocument.insertBefore(l,this.mapDivDocument.firstChild),this.mapObject=new gn({div:c,controls:this.appData.controls||[],interactions:this.noRotate?(0,mn.c)({altShiftDragRotate:!1,pinchRotate:!1}):(0,mn.c)().extend([new wn({condition:vn.Ko})]),fakeGps:s,fakeRadius:a,homePosition:t,northUp:e.northUp||this.appData.northUp||!1,tapDuration:e.tapDuration||this.appData.tapDuration||3e3,homeMarginPixels:e.homeMarginPixels||this.appData.homeMarginPixels||50,tapUIVanish:e.tapUIVanish||this.appData.tapUIVanish||!1});let u=null;if(this.overlay&&(u=`${this.mapDiv}_back`,l=Xe(`<div id="${u}" class="map" style="top:0; left:0; right:0; bottom:0; position:absolute;"></div>`)[0],this.mapDivDocument.insertBefore(l,this.mapDivDocument.firstChild),this.backMap=new gn({off_control:!0,div:u})),this.mapboxgl){const e=this.mapboxgl;delete this.mapboxgl;const t=`${this.mapDiv}_mapbox`;l=Xe(`<div id="${t}" class="map" style="top:0; left:0; right:0; bottom:0; position:absolute;visibility:hidden;"></div>`)[0],this.mapDivDocument.insertBefore(l,this.mapDivDocument.firstChild),this.mapboxMap=new e.Map({attributionControl:!1,boxZoom:!1,container:t,doubleClickZoom:!1,dragPan:!1,dragRotate:!1,interactive:!1,keyboard:!1,pitchWithRotate:!1,scrollZoom:!1,touchZoomRotate:!1})}return this.startFrom=this.appData.startFrom,{homePos:t,defZoom:n,zoomRestriction:r,mercMinZoom:i,mercMaxZoom:o}}handlePois(e,t){return this.pois=e,this.sourcesLoader(t).then((e=>this.handleSources(e)))}handleSources(e){this.mercSrc=e.reduce(((e,t)=>e||(t instanceof tn&&!(t instanceof Sn)?t:void 0)),null);const t=[];this.cacheHash={};for(let n=0;n<e.length;n++){const r=e[n];if(r.setMap(this.mapObject),r instanceof nn){if(!this.mapboxMap)throw"To use mapbox gl based base map, you have to make Maplat object with specifying 'mapboxgl' option.";r.mapboxMap=this.mapboxMap}t.push(r),this.cacheHash[r.mapID]=r}this.dispatchEvent(new Oe("sourceLoaded",e)),this.setInitialMap(t),this.setMapClick(),this.setPointerEvents(),this.setMapOnOff(),this.setMouseCursor(),this.setBackMapBehavior(),this.raiseChangeViewpoint()}async setInitialMap(e){const t=this.initialRestore.mapID||this.startFrom||e[e.length-1].mapID;this.from=e.reduce(((e,n)=>e?e instanceof xn||n.mapID==t?e:n:n.mapID!=t?n:e),void 0),await this.changeMap(t,this.initialRestore)}setMapClick(){this.mapObject.on("click",(e=>{this.logger.debug(e.pixel),this.lastClickEvent=e;const t=[];if(e.target.forEachFeatureAtPixel(e.pixel,(n=>{this.logger.debug(e.pixel),n.get("datum")&&t.push(n.get("datum"))})),t.length>0)this.dispatchEvent(new Oe("clickMarker",t[0])),this.dispatchEvent(new Oe("clickMarkers",t));else{const t=e.coordinate;this.dispatchEvent(new Oe("clickMapXy",t)),this.from.sysCoord2MercAsync(t).then((e=>{this.dispatchEvent(new Oe("clickMapMerc",e));const t=(0,je.vs)(e,"EPSG:3857","EPSG:4326");this.dispatchEvent(new Oe("clickMap",{longitude:t[0],latitude:t[1]}))}))}}))}setPointerEvents(){let e,t=!1,n=!1;const r={},i=n=>{this.dispatchEvent(new Oe("pointerMoveOnMapXy",n)),this.from.sysCoord2MercAsync(n).then((n=>{if(this.dispatchEvent(new Oe("pointerMoveOnMapMerc",n)),e){const t=e;e=!1,i(t)}else t=!1}))};this.mapObject.on("pointermove",(r=>{n||(t?e=r.coordinate:(t=!0,i(r.coordinate)))})),this.mapObject.on("pointerdown",(e=>{e.originalEvent&&null!=e.originalEvent.pointerId&&(r[e.originalEvent.pointerId]=!0),n=!0})),this.mapObject.on("pointerdrag",(e=>{e.originalEvent&&null!=e.originalEvent.pointerId&&(r[e.originalEvent.pointerId]=!0),n=!0})),this.mapObject.on("pointerup",(e=>{e.originalEvent&&null!=e.originalEvent.pointerId?(delete r[e.originalEvent.pointerId],0==Object.keys(r).length&&(n=!1)):e.originalEvent&&e.originalEvent.touches?0==e.originalEvent.touches.length&&(n=!1):n=!1}))}setMapOnOff(){let e;this.mapObject.on("click",(()=>{e&&(clearTimeout(e),e=void 0);const t=this.mapDivDocument.querySelectorAll(".ol-control");if(!this.mapObject.tapUIVanish||t.length&&t[0].classList.contains("fade"))for(let e=0;e<t.length;e++)t[e].classList.remove("fade");else{for(let e=0;e<t.length;e++)t[e].classList.add("fade");e=setTimeout((()=>{e=void 0;const t=this.mapDivDocument.querySelectorAll(".ol-control");for(let e=0;e<t.length;e++)t[e].classList.remove("fade")}),this.mapObject.tapDuration)}})),this.mapObject.on("pointerdrag",(()=>{e&&(clearTimeout(e),e=void 0);const t=this.mapDivDocument.querySelectorAll(".ol-control");for(let e=0;e<t.length;e++)t[e].classList.add("fade")})),this.mapObject.on("moveend",(()=>{e&&(clearTimeout(e),e=void 0),e=setTimeout((()=>{e=void 0;const t=this.mapDivDocument.querySelectorAll(".ol-control");for(let e=0;e<t.length;e++)t[e].classList.remove("fade")}),this.mapObject.tapDuration)}))}setMouseCursor(){this.mapObject.on("pointermove",(e=>{const t=e.target.getEventPixel(e.originalEvent),n=e.target.hasFeatureAtPixel(t),r=e.target.getTarget();if(n){const t=e.target.forEachFeatureAtPixel(e.pixel,(e=>{if(e.get("datum"))return e}));this.mapDivDocument.querySelector(`#${r}`).style.cursor=t?"pointer":""}else this.mapDivDocument.querySelector(`#${r}`).style.cursor=""}));this.mapObject.on("moveend",(e=>{let t=e.frameState.viewState.center;const n=this.from;n.insideCheckSysCoord(t)||(t=n.modulateSysCoordInside(t),e.target.getView().setCenter(t))}))}setBackMapBehavior(){this.mapObject.on("postrender",(e=>{if(!this.backMap)return;if(this.__backMapMoving)return void this.logger.debug("Backmap moving skipped");const t=this.backMap.getSource();t&&(this.__backMapMoving=!0,this.logger.debug("Backmap moving started"),this.convertParametersFromCurrent(t,(e=>{const t=this.backMap.getView();t.setCenter(e[0]),t.setZoom(e[1]),t.setRotation(this.noRotate?0:e[2]),this.logger.debug("Backmap moving ended"),this.__backMapMoving=!1})))}))}raiseChangeViewpoint(){this.mapObject.on("postrender",(e=>{const t=this.mapObject.getView(),n=t.getCenter(),r=t.getDecimalZoom(),i=He(180*t.getRotation()/Math.PI);this.from.viewpoint2MercsAsync().then((e=>this.mercSrc.mercs2ViewpointAsync(e))).then((e=>{if(this.mobileMapMoveBuffer&&this.mobileMapMoveBuffer[0][0]==e[0][0]&&this.mobileMapMoveBuffer[0][1]==e[0][1]&&this.mobileMapMoveBuffer[1]==e[1]&&this.mobileMapMoveBuffer[2]==e[2])return;this.mobileMapMoveBuffer=e;const t=(0,je.vs)(e[0],"EPSG:3857","EPSG:4326"),o=He(180*e[2]/Math.PI);this.dispatchEvent(new Oe("changeViewpoint",{x:n[0],y:n[1],longitude:t[0],latitude:t[1],mercator_x:e[0][0],mercator_y:e[0][1],zoom:r,mercZoom:e[1],direction:o,rotation:i})),this.requestUpdateState({position:{x:n[0],y:n[1],zoom:r,rotation:i}})}))}))}currentMapInfo(){return Je(this.from)}mapInfo(e){return Je(this.cacheHash[e])}setMarker(e){this.logger.debug(e);const t=e.lnglat||[e.lng||e.longitude,e.lat||e.latitude],n=e.x,r=e.y,i=e.coordinates,o=this.from,s=e.icon?this.__selectedMarker==e.namespaceID&&e.selectedIcon?e.selectedIcon:e.icon:this.__selectedMarker==e.namespaceID?"assets/images/f115726e6249018905cca51653e1262c.png":ln;return(i?o.merc2SysCoordAsync_ignoreBackground(i):n&&r?new Promise((e=>{e(o.xy2SysCoord([n,r]))})):function(){const e=(0,je.vs)(t,"EPSG:4326","EPSG:3857");return o.merc2SysCoordAsync_ignoreBackground(e)}()).then((t=>{t&&o.insideCheckSysCoord(t)&&this.mapObject.setMarker(t,{datum:e},s)}))}resetMarker(){this.mapObject.resetMarker()}setLine(e){e.type="Line",!e.style&&e.stroke&&(e.style={stroke:e.stroke}),this.setVector(e)}setVector(e){let t;this.logger.debug(e);const n=(e,t=!1)=>Promise.all(e.map((e=>Array.isArray(e[0])?n(e,t):(t&&(e=(0,je.vs)(e,"EPSG:4326","EPSG:3857")),this.from.merc2SysCoordAsync(e)))));t=e.coordinates?n(e.coordinates):n(e.lnglats,!0),t.then((t=>{this.mapObject.setVector(t,e.type,e.style)}))}resetLine(){this.resetVector()}resetVector(){this.mapObject.resetVector()}redrawMarkers(e=void 0){if(e||(e=this.from),this.__redrawMarkerBlock){this.__redrawMarkerThrottle||(this.__redrawMarkerThrottle=[]);const t=this.__redrawMarkerThrottle;if(0==t.length||t[t.length-1]!==e)return void t.push(e)}this.__redrawMarkerBlock=!0;const t=e=>{const n=[];let r;this.resetMarker(),this.stateBuffer.hideMarker||(Object.keys(this.pois).map((e=>{const t=this.pois[e];t.hide||t.pois.map((e=>{const i=cr(e,t,this);lr(i,t,this),this.__selectedMarker==i.namespaceID?r=i:n.push(this.setMarker(i))}))})),e.pois&&Object.keys(e.pois).map((t=>{const i=e.pois[t];i.hide||i.pois.map((t=>{const o=cr(t,i,e,this);lr(o,i,e,this),this.__selectedMarker==o.namespaceID?r=o:n.push(this.setMarker(o))}))})));let i=Promise.all(n);r&&(i=i.then((()=>this.setMarker(r)))),i.then((()=>{this.__redrawMarkerThrottle&&this.__redrawMarkerThrottle.length>0?t(this.__redrawMarkerThrottle.shift()):this.__redrawMarkerBlock=!1}))};t(e)}selectMarker(e){const t=this.getMarker(e);if(!t)return;this.__selectedMarker=e;const n={latitude:t.lnglat?t.lnglat[1]:t.lat?t.lat:t.latitude,longitude:t.lnglat?t.lnglat[0]:t.lng?t.lng:t.longitude};this.setViewpoint(n),this.redrawMarkers()}unselectMarker(){delete this.__selectedMarker,this.redrawMarkers()}getMarker(e){if(e.indexOf("#")<0){let t;return Object.keys(this.pois).map((n=>{this.pois[n].pois.map(((r,i)=>{r.id==e&&(t=this.pois[n].pois[i])}))})),t}{const t=e.split("#"),n=this.cacheHash[t[0]];if(n)return n.getPoi(t[1])}}updateMarker(e,t,n){const r=this.getMarker(e);r&&(t=Be(t||{}),n?(Object.keys(r).map((e=>{"id"!=e&&"namespaceID"!=e&&delete r[e]})),Object.assign(r,t)):Object.keys(t).map((e=>{"id"!=e&&"namespaceID"!=e&&("____delete____"==t[e]?delete r[e]:r[e]=t[e])})),this.redrawMarkers())}addMarker(e,t){if(t||(t="main"),t.indexOf("#")<0){if(this.pois[t])return this.pois[t].pois.push(Be(e)),Fe(this.pois,t,{name:this.appName}),this.dispatchPoiNumber(),this.redrawMarkers(),e.namespaceID}else{const n=t.split("#"),r=this.cacheHash[n[0]];if(r){const t=r.addPoi(e,n[1]);return this.dispatchPoiNumber(),this.redrawMarkers(),t}}}removeMarker(e){if(e.indexOf("#")<0)Object.keys(this.pois).map((t=>{this.pois[t].pois.map(((n,r)=>{n.id==e&&(delete this.pois[t].pois[r],this.dispatchPoiNumber(),this.redrawMarkers())}))}));else{const t=e.split("#"),n=this.cacheHash[t[0]];n&&(n.removePoi(t[1]),this.dispatchPoiNumber(),this.redrawMarkers())}}clearMarker(e){if(e||(e="main"),e.indexOf("#")<0){if("all"==e)Object.keys(this.pois).map((e=>{this.pois[e].pois=[]}));else{if(!this.pois[e])return;this.pois[e].pois=[]}this.dispatchPoiNumber(),this.redrawMarkers()}else{const t=e.split("#"),n=this.cacheHash[t[0]];n&&(n.clearPoi(t[1]),this.dispatchPoiNumber(),this.redrawMarkers())}}showAllMarkers(){this.requestUpdateState({hideMarker:0}),this.redrawMarkers()}hideAllMarkers(){this.requestUpdateState({hideMarker:1}),this.redrawMarkers()}dispatchPoiNumber(){this.dispatchEvent(new Oe("poi_number",this.listPoiLayers(!1,!0).reduce(((e,t)=>e+t.pois.length),0)))}listPoiLayers(e=!1,t=!1){const n=Object.keys(this.pois).sort(((e,t)=>"main"==e?-1:"main"==t?1:e<t?-1:e>t?1:0)).map((e=>this.pois[e])).filter((n=>t?e?n.pois.length&&n.hide:n.pois.length:!e||n.hide)),r=this.from.listPoiLayers(e,t);return n.concat(r)}showPoiLayer(e){const t=this.getPoiLayer(e);t&&(delete t.hide,this.requestUpdateState({hideLayer:this.listPoiLayers(!0).map((e=>e.namespaceID)).join(",")}),this.redrawMarkers())}hidePoiLayer(e){const t=this.getPoiLayer(e);t&&(t.hide=!0,this.requestUpdateState({hideLayer:this.listPoiLayers(!0).map((e=>e.namespaceID)).join(",")}),this.redrawMarkers())}getPoiLayer(e){if(e.indexOf("#")<0)return this.pois[e];{const t=e.split("#"),n=this.cacheHash[t[0]];if(n)return n.getPoiLayer(t[1])}}addPoiLayer(e,t){if("main"!=e&&!this.pois[e])if(e.indexOf("#")<0)this.pois[e]=Ze(t||[],e,{name:this.appName}),this.redrawMarkers();else{const n=e.split("#"),r=this.cacheHash[n[0]];r&&(r.addPoiLayer(n[1],t),this.redrawMarkers())}}removePoiLayer(e){if("main"!=e&&this.pois[e])if(e.indexOf("#")<0)delete this.pois[e],this.requestUpdateState({hideLayer:this.listPoiLayers(!0).map((e=>e.namespaceID)).join(",")}),this.dispatchPoiNumber(),this.redrawMarkers();else{const t=e.split("#"),n=this.cacheHash[t[0]];n&&(n.removePoiLayer(t[1]),this.requestUpdateState({hideLayer:this.listPoiLayers(!0).map((e=>e.namespaceID)).join(",")}),this.dispatchPoiNumber(),this.redrawMarkers())}}addLine(e){this.vectors.push(e),this.setLine(e)}addVector(e){this.vectors.push(e),this.setVector(e)}clearLine(){this.vectors=[],this.resetLine()}clearVector(){this.vectors=[],this.resetVector()}setGPSMarker(e){this.currentPosition=e,this.from.setGPSMarker(e,!0)}changeMap(e,t){void 0===t&&(t={});const n=this.mercSrc,r=this.cacheHash[e];return this.changeMapSeq||(this.changeMapSeq=Promise.resolve()),this.changeMapSeq=this.changeMapSeq.then((()=>new Promise(((e,i)=>{this.convertParametersFromCurrent(r,(i=>{let o=null,s=null;const a=t.backgroundID?this.cacheHash[t.backgroundID]:void 0;if(this.backMap&&(o=this.backMap.getSource(),r instanceof tn?this.backMap.exchangeSource():(a?(s=a,this.backMap.exchangeSource(s)):o?s=o:(s=n,this.from instanceof tn&&(s=this.from instanceof Sn?this.mapObject.getSource():this.from),this.backMap.exchangeSource(s)),this.requestUpdateState({backgroundID:s.mapID}))),r instanceof Sn){if(this.mapObject.setLayer(r),a)this.mapObject.exchangeSource(a);else if(!(this.from instanceof tn)){const e=o||n;this.mapObject.exchangeSource(e)}this.requestUpdateState({backgroundID:this.mapObject.getSource().mapID})}else this.mapObject.setLayer(),this.mapObject.exchangeSource(r);const c={mapID:r.mapID};r instanceof tn&&!(r instanceof Sn)&&(c.backgroundID="____delete____"),this.requestUpdateState(c),this.from=r,this.dispatchPoiNumber();const l=this.mapObject.getView();if(this.appData.zoomRestriction&&(l.setMaxZoom(r.maxZoom),l.setMinZoom(r.minZoom||0)),r.insideCheckSysCoord(i[0])?(l.setCenter(i[0]),l.setZoom(i[1]),l.setRotation(this.noRotate?0:i[2])):this.__init||(this.dispatchEvent(new Oe("outOfMap",{})),this.goHome(r)),r.setGPSMarker(this.currentPosition,!0),t.hideLayer){t.hideLayer.split(",").map((e=>{const t=this.getPoiLayer(e);t&&(t.hide=!0)})),this.requestUpdateState({hideLayer:t.hideLayer})}t.hideMarker?this.hideAllMarkers():this.redrawMarkers(),this.resetVector();for(let e=0;e<this.vectors.length;e++)(e=>{this.setVector(e)})(this.vectors[e]);this.dispatchEvent(new Oe("mapChanged",this.getMapMeta(r.mapID))),this.mapObject.updateSize(),this.mapObject.renderSync(),t.position&&(this.__init=!1,r.setViewpoint(t.position)),t.transparency&&this.setTransparency(t.transparency),this.__init?(this.__init=!1,this.goHome(r)):this.backMap&&s&&this.convertParametersFromCurrent(s,(e=>{const t=this.backMap.getView();t.setCenter(e[0]),t.setZoom(e[1]),t.setRotation(this.noRotate?0:e[2]),this.backMap.updateSize(),this.backMap.renderSync()})),e(void 0)}))}))))}requestUpdateState(e){if(this.stateBuffer=Object.assign(this.stateBuffer,e),"____delete____"==this.stateBuffer.backgroundID&&delete this.stateBuffer.backgroundID,this.restoreSession){const t=Math.floor((new Date).getTime()/1e3);localStorage.setItem("epoch",`${t}`);const n=function(e){Object.keys(e).map((t=>{"position"==t?n(e[t]):"backgroundID"==t&&"____delete____"==e[t]?localStorage.removeItem(t):localStorage.setItem(t,e[t])}))};n(e)}this.timer&&clearTimeout(this.timer),this.timer=setTimeout((()=>{this.timer=void 0,this.dispatchEvent(new Oe("updateState",this.stateBuffer))}),50)}setTransparency(e){this.__transparency=e,this.mapObject.setTransparency(e),this.requestUpdateState({transparency:e})}getTransparency(){return null==this.__transparency?0:this.__transparency}setViewpoint(e){this.from.setViewpoint(e)}goHome(e){(e||this.from).goHome()}resetRotation(){this.from.resetRotation()}resetDirection(){this.from.resetDirection()}resetCirculation(){this.from.resetCirculation()}getMapMeta(e){let t;if(t=e?this.cacheHash[e]:this.from,t)return $e.reduce(((e,n)=>(e[n]=t[n],e)),{mapID:t.mapID,label:t.label})}getMapCacheEnable(e){let t;return t=e?this.cacheHash[e]:this.from,!!t&&t.getCacheEnable()}async getMapTileCacheStatsAsync(e){let t;return t=e?this.cacheHash[e]:this.from,t?await t.getTileCacheStatsAsync():{}}async getMapTileCacheSizeAsync(e){return(await this.getMapTileCacheStatsAsync(e)).size||0}async clearMapTileCacheAsync(e){let t;t=e?this.cacheHash[e]:this.from,t&&await t.clearTileCacheAsync()}async fetchAllMapTileCacheAsync(e,t){let n;n=e?this.cacheHash[e]:this.from,n?await n.fetchAllTileCacheAsync(t):t("stop",{})}async cancelMapTileCacheAsync(e){let t;t=e?this.cacheHash[e]:this.from,t&&await t.cancelTileCacheAsync()}convertParametersFromCurrent(e,t){const n=this.mapObject.getView();let r=this.from.viewpoint2MercsAsync();const i=on([n.getCenter(),n.getZoom(),n.getRotation()],10);if(this.mercBuffer&&this.mercBuffer.mercs&&this.mercBuffer.buffer[this.from.mapID]){const e=this.mercBuffer.buffer[this.from.mapID];e[0][0]==i[0][0]&&e[0][1]==i[0][1]&&e[1]==i[1]&&e[2]==i[2]?(this.logger.debug(e),this.logger.debug(i),this.logger.debug("From: Use buffer"),r=new Promise(((e,t)=>{e(this.mercBuffer.mercs)}))):(this.mercBuffer={buffer:{}},this.mercBuffer.buffer[this.from.mapID]=i)}else this.mercBuffer={buffer:{}},this.mercBuffer.buffer[this.from.mapID]=i;this.logger.debug(`From: Center: ${i[0]} Zoom: ${i[1]} Rotation: ${i[2]}`),this.logger.debug(`From: ${this.from.mapID}`),r.then((n=>{this.mercBuffer.mercs=n,this.logger.debug(`Mercs: ${n}`);let r=e.mercs2ViewpointAsync(n);const i=e.mapID;this.mercBuffer.buffer[i]&&(this.logger.debug("To: Use buffer"),r=new Promise(((e,t)=>{e(this.mercBuffer.buffer[i])}))),r.then((n=>{this.logger.debug(`To: Center: ${n[0]} Zoom: ${n[1]} Rotation: ${n[2]}`),this.logger.debug(`To: ${e.mapID}`),this.mercBuffer.buffer[e.mapID]=on(n,10),t(n)})).catch((e=>{throw e}))})).catch((e=>{throw e}))}translate(e){if(!e||"string"==typeof e)return e;const t=Object.keys(e);let n=t.reduce(((t,n,r,i)=>(n==this.appLang?t=[e[n],!0]:t&&("en"!=n||t[1])||(t=[e[n],!1]),r==i.length-1?t[0]:t)),void 0);if(n="string"==typeof n?n:`${n}`,this.i18n.exists(n,{ns:"translation",nsSeparator:"__X__yX__X__"}))return this.t(n,{ns:"translation",nsSeparator:"__X__yX__X__"});for(let r=0;r<t.length;r++){const i=t[r];this.i18n.addResource(i,"translation",n,e[i])}return this.t(n,{ns:"translation",nsSeparator:"__X__yX__X__"})}remove(){this.mapboxMap&&this.mapboxMap.remove(),this.mapDivDocument.innerHTML="",this.mapDivDocument.classList.remove("maplat")}}(async()=>{const e={mapboxgl:mapboxgl,mapboxToken:"YOUR-ACCESS-TOKEN",northUp:!0,tapDuration:6e4,homeMarginPixels:100,tapUIVanish:!0,div:"map"},t=new ur(e);await t.waitReady,console.log("####Message appReady"),console.log(t),console.log(t.currentMapInfo()),console.log(t.mapInfo("gsi"));let n=!1;t.addEventListener("clickMarker",(e=>{t.selectMarker(e.detail.namespaceID),console.log(`####Message clickMarker ${JSON.stringify(e.detail)}`)})),t.addEventListener("clickMap",(e=>console.log(`####Message clickMap ${JSON.stringify(e.detail)}`))),t.addLine({lnglats:[[141.151995,39.701599],[141.151137,39.703736],[141.1521671,39.7090232]],stroke:{color:"#ffcc33",width:2}}),t.addVector({type:"Line",lnglats:[[141.14791274070737,39.69741334474737],[141.14660382270813,39.69681897707071],[141.14725828170776,39.69597694743377],[141.14853501319885,39.69661259820805],[141.14900708198547,39.696034734109695]],style:{stroke:{color:"#ff0000",width:2}}}),t.addVector({type:"Polygon",lnglats:[[[141.15129232406616,39.6978013319974],[141.14970445632935,39.696967569469734],[141.15129232406616,39.695877884448194],[141.15272998809814,39.69686850790594],[141.15129232406616,39.6978013319974]],[[141.15143179893494,39.697273008396415],[141.1508524417877,39.69687676304167],[141.15146398544312,39.69657957753276],[141.15143179893494,39.697273008396415]]],style:{stroke:{color:[0,255,0],width:2},fill:{color:[0,255,0,.4]}}}),t.addPoiLayer("main2"),t.addPoiLayer("morioka_ndl2#main2",{icon:"parts_test/blue_marker.png",selectedIcon:"parts_test/red_marker.png"}),document.getElementById("show").addEventListener("click",(()=>t.showPoiLayer("main"))),document.getElementById("hide").addEventListener("click",(()=>t.hidePoiLayer("main"))),document.getElementById("clear").addEventListener("click",(()=>t.clearMarker("main"))),document.getElementById("move").addEventListener("click",(()=>{let e;e=n?{lnglat:[141.145358,39.69862]}:{lnglat:[141.146534,39.694758]},n=!n,t.updateMarker("main_1",e)})),document.getElementById("remove").addEventListener("click",(()=>t.removeMarker("main_2"))),document.getElementById("add2").addEventListener("click",(()=>t.addMarker({address:"岩手県盛岡市内丸1-42",desc:"寛延２年創建で当時の藩主南部利視が初代藩主南部信直の功績を称え社殿を建立し御霊を勧請したのが始まりとされている。",icon:void 0,image:"sakurayama_jinja.jpg",lnglat:[141.151995,39.701599],name:"桜山神社",selectedIcon:void 0,start:1749},"main2"))),document.getElementById("clear2").addEventListener("click",(()=>t.clearMarker("main2"))),document.getElementById("addMap").addEventListener("click",(()=>t.addMarker({address:"岩手県盛岡市内丸1-37",desc:"南部（盛岡）藩南部氏の居城である。西部を流れる北上川と南東部を流れる中津川の合流地、現在の盛岡市中心部にあった花崗岩丘陵に築城された連郭式平山城。",icon:void 0,image:"moriokajo.jpg",lnglat:[141.1501111,39.69994722],name:{ja:"盛岡城",en:"Morioka Castle"},selectedIcon:void 0,start:1598},"morioka_ndl2#main2"))),document.getElementById("clearMap").addEventListener("click",(()=>t.clearMarker("morioka_ndl2#all"))),document.getElementById("unSelect").addEventListener("click",(()=>t.unselectMarker())),document.getElementById("showAll").addEventListener("click",(()=>t.showAllMarkers())),document.getElementById("hideAll").addEventListener("click",(()=>t.hideAllMarkers())),document.getElementById("morioka").addEventListener("click",(()=>t.changeMap("morioka"))),document.getElementById("maplat").addEventListener("click",(()=>t.changeMap("morioka_ndl2"))),document.getElementById("tms").addEventListener("click",(()=>t.changeMap("morioka_ndl_affine"))),document.getElementById("osm").addEventListener("click",(()=>t.changeMap("osm"))),document.getElementById("gsi").addEventListener("click",(()=>t.changeMap("gsi"))),document.getElementById("mapbox").addEventListener("click",(()=>t.changeMap("mapbox"))),document.getElementById("go_home").addEventListener("click",(()=>t.goHome())),document.getElementById("reset_rotation").addEventListener("click",(()=>t.resetRotation())),document.getElementById("reset_direction").addEventListener("click",(()=>t.resetDirection())),document.getElementById("reset_circulation").addEventListener("click",(()=>t.resetCirculation())),document.getElementById("map_remove").addEventListener("click",(()=>t.remove()))})()}},function(e){var t;t=3904,e(e.s=t)}]);
//# sourceMappingURL=maplatcore_api.js.map